<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Kaspi ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨å¢å¼ºç‰ˆï¼ˆä¼˜åŒ–ç‰ˆï¼‰</title>
<style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            padding: 10px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #ff8c00, #ffd700, #ff8c00);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 15px;
            padding-top: 40px;
        }

        .header h1 {
            font-size: 24px;
            color: #1a2a6c;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .header h2 {
            font-size: 18px;
            color: #d35400;
            font-weight: 600;
        }

        .header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 3px;
            background: linear-gradient(90deg, #1a2a6c, #3498db, #1a2a6c);
            border-radius: 2px;
        }

        .exchange-rate {
            background-color: #e3f2fd;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid #bbdefb;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .exchange-rate label {
            font-weight: bold;
            color: #0d47a1;
            font-size: 16px;
            white-space: nowrap;
        }

        .exchange-rate input {
            font-size: 16px;
            padding: 8px 12px;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            width: 150px;
            text-align: center;
            color: #1565c0;
            font-weight: bold;
            background-color: #fff;
            margin: 0;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .section {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 18px;
            color: #1a2a6c;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .form-control::placeholder {
            color: #aaa;
            font-style: italic;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }

        .dimensions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
        
        /* æ–°å¢Kaspiå”®ä»·åŒåˆ—æ ·å¼ */
        .kaspi-price-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .kaspi-price-box {
            display: flex;
            flex-direction: column;
        }
        
        .kaspi-price-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 4px;
        }

        .output-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .output-group {
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #c8e6c9;
        }

        .output-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #2e7d32;
            font-size: 14px;
        }

        .output-value {
            font-size: 16px;
            font-weight: bold;
            color: #1b5e20;
            background-color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #a5d6a7;
            text-align: right;
        }

        .results-section {
            background-color: #fffde7;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #ffe082;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .result-item {
            padding: 12px;
            border-radius: 8px;
            background-color: #fff9c4;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-item.final {
            background-color: #ffecb3;
            padding: 16px;
            font-weight: bold;
        }

        .result-label {
            font-weight: 600;
            color: #5d4037;
            font-size: 15px;
        }

        .result-value {
            font-size: 18px;
            font-weight: bold;
            color: #e65100;
            min-width: 100px;
            text-align: right;
        }

        .btn-calculate {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-calculate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-calculate:active {
            transform: translateY(1px);
        }

        .footer {
            text-align: center;
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 13px;
            padding-top: 12px;
            border-top: 1px solid #ecf0f1;
        }

        .category-container {
            position: relative;
        }

        .category-levels {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .category-search {
            position: relative;
        }

        .category-search input {
            padding-right: 40px;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #7f8c8d;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }

        .search-result-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .search-result-item:hover {
            background-color: #f0f8ff;
        }

        .language-switcher {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .lang-btn {
            background: #1a2a6c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 13px;
        }

        .lang-btn.active {
            background: #ff8c00;
            transform: scale(1.05);
        }

        .currency-selector {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .currency-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .currency-radio {
            margin-right: 6px;
        }

        .currency-label {
            font-weight: 500;
            font-size: 14px;
        }

        /* å¼€å…³æ ·å¼ */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
            padding: 8px 0;
            border-top: 1px dashed #e0e0e0;
        }

        .switch-label {
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(23px);
        }

        /* è´¹ç”¨å•ä»·å®¹å™¨æ ·å¼ */
        .cost-price-container {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 8px;
            margin-top: 12px;
            background: #f5f9ff; 
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e3f2fd;
        }

        .cost-price-group {
            background: #fff; 
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #bbdefb;
            transition: all 0.3s ease;
        }

        .cost-price-group:hover {
            border-color: #64b5f6;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }

        .cost-price-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #1976d2;
            font-weight: 500;
        }

        .cost-price-group input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e3f2fd;
            border-radius: 6px;
            font-size: 14px;
            color: #0d47a1;
            background: #fff;
            transition: all 0.3s ease;
        }

        .cost-price-group input:focus {
            border-color: #2196f3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        /* æ–°å¢æ ·å¼ */
        .commission-display {
            margin-top: 5px;
            font-size: 13px;
            color: #3498db;
            font-weight: 500;
        }
        
        /* ä¿„è¯­ç•Œé¢æ ·å¼ */
        .lang-ru .purchase-label::after,
        .lang-ru .shipping-label::after {
            content: " (Â¥)";
        }
        
        .lang-ru .form-control::placeholder {
            font-style: normal;
        }
        
        .toggle-off {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }
            
            .header h2 {
                font-size: 16px;
            }
            
            .exchange-rate {
                flex-direction: column;
                align-items: center;
                gap: 6px;
            }
            
            .exchange-rate label {
                font-size: 14px;
            }
            
            .exchange-rate input {
                width: 100%;
                max-width: 200px;
            }
            
            .dimensions {
                grid-template-columns: 1fr 1fr 1fr;
            }
            
            .section {
                padding: 12px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .btn-calculate {
                padding: 12px;
                font-size: 16px;
                margin: 15px 0;
            }
            
            .result-label, .result-value {
                font-size: 14px;
            }
            
            .result-value {
                min-width: 80px;
                font-size: 16px;
            }
            
            .currency-selector {
                flex-direction: column;
                gap: 8px;
            }
            
            .language-switcher {
                top: 5px;
                right: 5px;
            }
            
            .lang-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
            
            .results-section {
                padding: 15px;
            }
            
            .kaspi-price-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* å¹³æ¿ä¼˜åŒ– */
        @media (min-width: 481px) and (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
            
            .output-section {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header {
                padding-top: 30px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .header h2 {
                font-size: 17px;
            }
            
            .dimensions {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 10px;
            }
        }
        
        /* æ¡Œé¢ä¼˜åŒ– */
        @media (min-width: 769px) {
            .input-section {
                grid-template-columns: 1fr 1fr;
            }
            
            .output-section {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* é¿å…ç§»åŠ¨ç«¯é”®ç›˜å¼¹å‡ºæ—¶é®æŒ¡è¾“å…¥æ¡† */
        @media (max-height: 600px) and (orientation: landscape) {
            .container {
                max-height: 95vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1 id="company-name">æ–°ç–†èˆªè´¸é€šå›½é™…ä¾›åº”é“¾æœ‰é™å…¬å¸</h1>
<h2 id="app-title">Kaspi ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨å¢å¼ºç‰ˆ</h2>
<div class="language-switcher">
<button class="lang-btn active" data-lang="zh">ä¸­æ–‡</button>
<button class="lang-btn" data-lang="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</button>
</div>
</div>
<div class="exchange-rate">
<label id="exchange-label">å½“å‰æ±‡ç‡ï¼š1å…ƒäººæ°‘å¸å…‘æ¢</label>
<input id="exchangeRate" min="0" placeholder="è¾“å…¥æ±‡ç‡" step="0.01" type="number" value="70"/>
<label id="currency-label">å“ˆè¨å…‹æ–¯å¦åšæˆˆ</label>
<div class="error-message" id="exchange-error">æ±‡ç‡å¿…é¡»å¤§äº0</div>
</div>
<div class="input-section">
<div class="section">
<h3 class="section-title" id="product-info-title">äº§å“ä¿¡æ¯</h3>
<div class="form-group category-container">
<label for="category-search" id="category-label">å•†å“åˆ†ç±»</label>
<div class="category-search">
<input autocomplete="off" class="form-control" id="category-search" placeholder="æœç´¢åˆ†ç±»..." type="text"/>
<span class="search-icon">ğŸ”</span>
<div class="search-results" id="search-results"></div>
</div>
<select class="form-control" id="category-select">
<option data-commission="" value="">-- è¯·é€‰æ‹©å•†å“åˆ†ç±» --</option>
</select>
<div class="commission-display" id="commission-display">å½“å‰ä½£é‡‘ç‡ï¼š0%</div>
</div>
<div class="form-group">
<label for="purchasePrice" id="purchase-label">é‡‡è´­ä»· (Â¥)</label>
<input class="form-control" id="purchasePrice" min="0" placeholder="è¾“å…¥é‡‡è´­ä»·" step="0.01" type="number" value=""/>
<div class="error-message" id="purchase-error">è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‡è´­ä»·</div>
</div>
<div class="form-group">
<label for="shippingCost" id="shipping-label">è¿è´¹ (Â¥)</label>
<input class="form-control" id="shippingCost" min="0" placeholder="é˜¿æ‹‰æœ¨å›¾è¿è´¹" step="0.01" type="number" value=""/>
<div class="error-message" id="shipping-error">è¯·è¾“å…¥æœ‰æ•ˆçš„è¿è´¹</div>
</div>
<div class="form-group">
<label id="profit-label">åˆ©æ¶¦ç‡ï¼ˆ%ï¼‰</label>
<input class="form-control" id="profitMargin" min="0" placeholder="è¾“å…¥åˆ©æ¶¦ç‡" step="0.1" type="number" value=""/>
<div class="error-message" id="profit-error">è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ©æ¶¦ç‡</div>
</div>
<div class="form-group">
<label id="cashback-label">ä¸‹å•è¿”åˆ©ï¼ˆ%ï¼‰</label>
<input class="form-control" id="cashback" min="0" placeholder="è¾“å…¥ä¸‹å•è¿”åˆ©" step="0.1" type="number" value=""/>
</div>
<div class="form-group">
<label for="paymentMethod" id="payment-label">æ±‡æ¬¾æ–¹å¼</label>
<select class="form-control" id="paymentMethod">
<option value="publicToPublic">é“¶è¡Œå…¬å¯¹å…¬</option>
<option value="publicToPrivate">é“¶è¡Œå…¬å¯¹ç§</option>
<option value="privateToPrivate">é“¶è¡Œç§å¯¹ç§</option>
<option value="wechat">å¾®ä¿¡</option>
<option value="alipay">æ”¯ä»˜å®</option>
<option value="kaspi">Kaspi.kz</option>
</select>
</div>
</div>
<div class="section">
<h3 class="section-title" id="logistics-title">ç‰©æµä¿¡æ¯</h3>
<div class="form-group">
<label id="dimension-label">å°ºå¯¸ï¼ˆå˜ç±³ï¼‰</label>
<div class="dimensions">
<div>
<input class="form-control" id="length" min="0.1" placeholder="é•¿" step="0.1" type="number" value=""/>
</div>
<div>
<input class="form-control" id="width" min="0.1" placeholder="å®½" step="0.1" type="number" value=""/>
</div>
<div>
<input class="form-control" id="height" min="0.1" placeholder="é«˜" step="0.1" type="number" value=""/>
</div>
</div>
</div>
<div class="form-group">
<label for="volume" id="volume-label">ä½“ç§¯ï¼ˆç«‹æ–¹ç±³ï¼‰</label>
<input class="form-control output-value" id="volume" readonly="" type="text"/>
</div>
<div class="form-group">
<label for="weight" id="weight-label">é‡é‡ï¼ˆåƒå…‹ï¼‰</label>
<input class="form-control" id="weight" min="0.01" placeholder="è¾“å…¥é‡é‡" step="0.01" type="number" value=""/>
<div class="error-message" id="weight-error">è¯·è¾“å…¥æœ‰æ•ˆçš„é‡é‡</div>
</div>
<!-- ä¿®æ”¹Kaspiå”®ä»·ä¸ºåŒåˆ—æ˜¾ç¤º -->
<div class="form-group">
<label id="kaspi-price-label">Kaspi å”®ä»·</label>
<div class="kaspi-price-container">
<div class="kaspi-price-box">
<div class="kaspi-price-label" id="kaspi-price-cny-label">äººæ°‘å¸ (Â¥)</div>
<input class="form-control output-value" id="kaspiPriceCny" readonly="" type="text"/>
</div>
<div class="kaspi-price-box">
<div class="kaspi-price-label" id="kaspi-price-kzt-label">åšæˆˆ (â‚¸)</div>
<input class="form-control output-value" id="kaspiPriceKzt" readonly="" type="text"/>
</div>
</div>
</div>
<!-- è´¹ç”¨å•ä»·è¾“å…¥æ¡† -->
<div class="cost-price-container">
<div class="cost-price-group">
<label id="overseas-unit-label">æµ·å¤–ä»“å•ä»· (Â¥/mÂ³)</label>
<input id="overseasUnitPrice" min="0" step="1" type="number" value="1000"/>
</div>
<div class="cost-price-group">
<label id="firstmile-unit-label">å¤´ç¨‹å•ä»· (Â¥/mÂ³)</label>
<input id="firstMileUnitPrice" min="0" step="1" type="number" value="100"/>
</div>
</div>
</div>
</div>
<button class="btn-calculate" data-ru="Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ" data-zh="è®¡ç®—åˆ©æ¶¦" id="calculateBtn">è®¡ç®—åˆ©æ¶¦</button>
<div class="output-section">
<div class="section">
<h3 class="section-title" id="fees-title">å¤´ç¨‹ã€æµ·å¤–ä»“è´¹ç”¨</h3>
<div class="switch-container">
<span class="switch-label">æµ·å¤–ä»“è´¹ç”¨</span>
<label class="switch">
<input checked="" id="overseasToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="overseas-label">æµ·å¤–ä»“è´¹ç”¨</label>
<input class="form-control output-value" id="overseasWarehouse" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">å¤´ç¨‹è´¹ç”¨</span>
<label class="switch">
<input checked="" id="firstMileToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="firstmile-label">å¤´ç¨‹è´¹ç”¨</label>
<input class="form-control output-value" id="firstMile" readonly="" type="text">
</input></div>
</div>
<div class="section">
<h3 class="section-title" id="platform-title">å¹³å°è´¹ç”¨</h3>
<div class="output-group">
<label id="cashback-amount-label">ä¸‹å•è¿”åˆ©</label>
<input class="form-control output-value" id="cashbackAmount" readonly="" type="text">
</input></div>
<div class="output-group">
<label id="kaspi-shipping-label">Kaspi è¿è´¹</label>
<input class="form-control output-value" id="kaspiShipping" readonly="" type="text">
</input></div>
<div class="output-group">
<label id="platform-fee-label">å¹³å°ä½£é‡‘</label>
<input class="form-control output-value" id="platformFee" readonly="" type="text"/>
</div>
<div class="output-group">
<label id="withdrawal-tax-label">æç°ç¨ï¼ˆ4%ï¼‰</label>
<input class="form-control output-value" id="withdrawalTax" readonly="" type="text"/>
</div>
</div>
</div>
<div class="results-section">
<h3 class="section-title" id="return-title">å›æ¬¾è´¹ç”¨</h3>
<div class="switch-container">
<span class="switch-label">æç°æ‰‹ç»­è´¹</span>
<label class="switch">
<input checked="" id="withdrawalFeeToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="withdrawal-fee-label">æç°æ‰‹ç»­è´¹ï¼ˆ1%ï¼‰</label>
<input class="form-control output-value" id="withdrawalFee" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">æ±‡æŸ</span>
<label class="switch">
<input checked="" id="exchangeLossToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="exchange-loss-label">æ±‡æŸï¼ˆ1.42%ï¼‰</label>
<input class="form-control output-value" id="exchangeLoss" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">æ±‡æ¬¾æ‰‹ç»­è´¹</span>
<label class="switch">
<input checked="" id="remittanceFeeToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="remittance-fee-label">æ±‡æ¬¾æ‰‹ç»­è´¹</label>
<input class="form-control output-value" id="remittanceFee" readonly="" type="text">
</input></div>
<div class="results-grid">
<div class="result-item">
<div class="result-label" id="kaspi-pay-label">Kaspi payæç°åˆ°è´¦é‡‘é¢</div>
<div class="result-value" id="kaspiPayAmount">0.00</div>
</div>
<div class="result-item">
<div class="result-label" id="return-amount-label">å›æ¬¾é‡‘é¢</div>
<div class="result-value" id="returnAmountDisplay">0.00</div>
</div>
<div class="result-item">
<div class="result-label" id="estimated-amount-label">é¢„ä¼°åˆ°è´¦é‡‘é¢</div>
<div class="result-value" id="estimatedAmount">0.00</div>
</div>
<div class="result-item final">
<div class="result-label" id="profit-label-final">åˆ©æ¶¦</div>
<div class="result-value" id="profit">0.00</div>
</div>
</div>
<div class="currency-selector">
<div class="currency-option">
<input checked="" class="currency-radio" id="currency-cny" name="currency" type="radio" value="cny"/>
<label class="currency-label" for="currency-cny" id="cny-label">äººæ°‘å¸ (CNY)</label>
</div>
<div class="currency-option">
<input class="currency-radio" id="currency-kzt" name="currency" type="radio" value="kzt"/>
<label class="currency-label" for="currency-kzt" id="kzt-label">å“ˆè¨å…‹æ–¯å¦åšæˆˆ (KZT)</label>
</div>
</div>
</div>
<div class="footer">
<p id="copyright">Â© 2023 æ–°ç–†èˆªè´¸é€šå›½é™…ä¾›åº”é“¾æœ‰é™å…¬å¸ | Kaspi ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨å¢å¼ºç‰ˆ</p>
</div>
</div>
<script>
        // å¤šè¯­è¨€æ”¯æŒ
        const translations = {
            zh: {
                companyName: "æ–°ç–†èˆªè´¸é€šå›½é™…ä¾›åº”é“¾æœ‰é™å…¬å¸",
                appTitle: "Kaspi ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨å¢å¼ºç‰ˆ",
                exchangeLabel: "å½“å‰æ±‡ç‡ï¼š1å…ƒäººæ°‘å¸å…‘æ¢",
                currencyLabel: "å“ˆè¨å…‹æ–¯å¦åšæˆˆ",
                productInfo: "äº§å“ä¿¡æ¯",
                categoryLabel: "å•†å“åˆ†ç±»",
                purchaseLabel: "é‡‡è´­ä»· (Â¥)",
                shippingLabel: "è¿è´¹ (Â¥)",
                profitLabel: "åˆ©æ¶¦ç‡ï¼ˆ%ï¼‰",
                cashbackLabel: "ä¸‹å•è¿”åˆ©ï¼ˆ%ï¼‰",
                paymentLabel: "æ±‡æ¬¾æ–¹å¼",
                logisticsTitle: "ç‰©æµä¿¡æ¯",
                dimensionLabel: "å°ºå¯¸ï¼ˆå˜ç±³ï¼‰",
                volumeLabel: "ä½“ç§¯ï¼ˆç«‹æ–¹ç±³ï¼‰",
                weightLabel: "é‡é‡ï¼ˆåƒå…‹ï¼‰",
                kaspiPriceLabel: "Kaspi å”®ä»·",
                feesTitle: "å¤´ç¨‹ã€æµ·å¤–ä»“è´¹ç”¨",
                overseasLabel: "æµ·å¤–ä»“è´¹ç”¨",
                firstmileLabel: "å¤´ç¨‹è´¹ç”¨",
                platformTitle: "å¹³å°è´¹ç”¨",
                cashbackAmountLabel: "ä¸‹å•è¿”åˆ©",
                kaspiShippingLabel: "Kaspi è¿è´¹",
                platformFeeLabel: "å¹³å°ä½£é‡‘",
                withdrawalTaxLabel: "æç°ç¨ï¼ˆ4%ï¼‰",
                returnTitle: "å›æ¬¾è´¹ç”¨",
                withdrawalFeeLabel: "æç°æ‰‹ç»­è´¹ï¼ˆ1%ï¼‰",
                exchangeLossLabel: "æ±‡æŸï¼ˆ1.42%ï¼‰",
                remittanceFeeLabel: "æ±‡æ¬¾æ‰‹ç»­è´¹",
                returnAmountLabel: "å›æ¬¾é‡‘é¢",
                kaspiPayLabel: "Kaspi payæç°åˆ°è´¦é‡‘é¢",
                estimatedAmountLabel: "é¢„ä¼°åˆ°è´¦é‡‘é¢",
                profitLabelFinal: "åˆ©æ¶¦",
                copyright: "Â© 2023 æ–°ç–†èˆªè´¸é€šå›½é™…ä¾›åº”é“¾æœ‰é™å…¬å¸ | Kaspi ç”µå•†åˆ©æ¶¦è®¡ç®—å™¨å¢å¼ºç‰ˆ",
                calculateBtn: "è®¡ç®—åˆ©æ¶¦",
                cnyLabel: "äººæ°‘å¸ (CNY)",
                kztLabel: "å“ˆè¨å…‹æ–¯å¦åšæˆˆ (KZT)",
                commissionLabel: "å½“å‰ä½£é‡‘ç‡ï¼š",
                purchasePlaceholder: "è¾“å…¥é‡‡è´­ä»·",
                shippingPlaceholder: "é˜¿æ‹‰æœ¨å›¾è¿è´¹",
                profitPlaceholder: "è¾“å…¥åˆ©æ¶¦ç‡",
                cashbackPlaceholder: "è¾“å…¥ä¸‹å•è¿”åˆ©",
                weightPlaceholder: "è¾“å…¥é‡é‡",
                lengthPlaceholder: "é•¿",
                widthPlaceholder: "å®½",
                heightPlaceholder: "é«˜",
                exchangePlaceholder: "è¾“å…¥æ±‡ç‡",
                categorySearchPlaceholder: "æœç´¢åˆ†ç±»...",
                overseasUnitLabel: "æµ·å¤–ä»“å•ä»· (Â¥/mÂ³)",
                firstmileUnitLabel: "å¤´ç¨‹å•ä»· (Â¥/mÂ³)"
            },
            ru: {
                companyName: "Ğ¡Ğ¸Ğ½ÑŒÑ†Ğ·ÑĞ½ÑĞºĞ°Ñ ĞœĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ğ°Ñ Ğ›Ğ¾Ğ³Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ¥Ğ°Ğ½ ĞœĞ°Ğ¾ Ğ¢ÑƒĞ½",
                appTitle: "Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ Kaspi",
                exchangeLabel: "Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ĞºÑƒÑ€Ñ: 1 ÑĞ°Ğ½ÑŒ = ",
                currencyLabel: "ĞºĞ°Ğ·Ğ°Ñ…ÑÑ‚Ğ°Ğ½ÑĞºĞ¸Ñ… Ñ‚ĞµĞ½Ğ³Ğµ",
                productInfo: "Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğµ",
                categoryLabel: "ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°",
                purchaseLabel: "Ğ—Ğ°ĞºÑƒĞ¿Ğ¾Ñ‡Ğ½Ğ°Ñ Ñ†ĞµĞ½Ğ° (â‚¸)",
                shippingLabel: "Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ (â‚¸)",
                profitLabel: "ĞœĞ°Ñ€Ğ¶Ğ° Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ (%)",
                cashbackLabel: "ĞšÑÑˆĞ±ÑĞº Ğ·Ğ° Ğ·Ğ°ĞºĞ°Ğ· (%)",
                paymentLabel: "Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹",
                logisticsTitle: "Ğ›Ğ¾Ğ³Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ",
                dimensionLabel: "Ğ Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ (ÑĞ¼)",
                volumeLabel: "ĞĞ±ÑŠĞµĞ¼ (Ğ¼Â³)",
                weightLabel: "Ğ’ĞµÑ (ĞºĞ³)",
                kaspiPriceLabel: "Ğ¦ĞµĞ½Ğ° Ğ½Ğ° Kaspi",
                feesTitle: "Ğ Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ Ğ½Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºÑƒ Ğ¸ ÑĞºĞ»Ğ°Ğ´",
                overseasLabel: "Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ñ€ÑƒĞ±ĞµĞ¶Ğ½Ğ¾Ğ³Ğ¾ ÑĞºĞ»Ğ°Ğ´Ğ° (â‚¸)",
                firstmileLabel: "Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ¼Ğ¸Ğ»Ğ¸ (â‚¸)",
                platformTitle: "ĞŸĞ»Ğ°Ñ‚ĞµĞ¶Ğ¸ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹",
                cashbackAmountLabel: "Ğ¡ÑƒĞ¼Ğ¼Ğ° ĞºÑÑˆĞ±ÑĞºĞ° (â‚¸)",
                kaspiShippingLabel: "Ğ”Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ° Kaspi (â‚¸)",
                platformFeeLabel: "ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ğ¿Ğ»Ğ°Ñ‚Ñ„Ğ¾Ñ€Ğ¼Ñ‹ (â‚¸)",
                withdrawalTaxLabel: "ĞĞ°Ğ»Ğ¾Ğ³ Ğ½Ğ° Ğ²Ñ‹Ğ²Ğ¾Ğ´ (4%) (â‚¸)",
                returnTitle: "Ğ Ğ°ÑÑ…Ğ¾Ğ´Ñ‹ Ğ½Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑÑ€ĞµĞ´ÑÑ‚Ğ²",
                withdrawalFeeLabel: "ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ğ·Ğ° Ğ²Ñ‹Ğ²Ğ¾Ğ´ (1%) (â‚¸)",
                exchangeLossLabel: "ĞŸĞ¾Ñ‚ĞµÑ€Ğ¸ Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ğ¼ĞµĞ½Ğµ (1.42%) (â‚¸)",
                remittanceFeeLabel: "ĞšĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ Ğ·Ğ° Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´ (â‚¸)",
                returnAmountLabel: "Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° (â‚¸)",
                kaspiPayLabel: "Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Kaspi pay (â‚¸)",
                estimatedAmountLabel: "ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ (â‚¸)",
                profitLabelFinal: "ĞŸÑ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ (â‚¸)",
                copyright: "Â© 2023 Ğ¡Ğ¸Ğ½ÑŒÑ†Ğ·ÑĞ½ÑĞºĞ°Ñ ĞœĞµĞ¶Ğ´ÑƒĞ½Ğ°Ñ€Ğ¾Ğ´Ğ½Ğ°Ñ Ğ›Ğ¾Ğ³Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞšĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ Ğ¥Ğ°Ğ½ ĞœĞ°Ğ¾ Ğ¢ÑƒĞ½ | Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸ Kaspi",
                calculateBtn: "Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»ÑŒ",
                cnyLabel: "Ğ®Ğ°Ğ½ÑŒ (CNY)",
                kztLabel: "Ğ¢ĞµĞ½Ğ³Ğµ (KZT)",
                commissionLabel: "Ğ¢ĞµĞºÑƒÑ‰Ğ°Ñ ĞºĞ¾Ğ¼Ğ¸ÑÑĞ¸Ñ: ",
                purchasePlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ·Ğ°ĞºÑƒĞ¿Ğ¾Ñ‡Ğ½ÑƒÑ Ñ†ĞµĞ½Ñƒ",
                shippingPlaceholder: "Ğ¡Ñ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸ Ğ² ĞĞ»Ğ¼Ğ°Ñ‚Ñ‹",
                profitPlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¼Ğ°Ñ€Ğ¶Ñƒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸",
                cashbackPlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºÑÑˆĞ±ÑĞº Ğ·Ğ° Ğ·Ğ°ĞºĞ°Ğ·",
                weightPlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²ĞµÑ",
                lengthPlaceholder: "Ğ”Ğ»Ğ¸Ğ½Ğ°",
                widthPlaceholder: "Ğ¨Ğ¸Ñ€Ğ¸Ğ½Ğ°",
                heightPlaceholder: "Ğ’Ñ‹ÑĞ¾Ñ‚Ğ°",
                exchangePlaceholder: "Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºÑƒÑ€Ñ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°",
                categorySearchPlaceholder: "ĞŸĞ¾Ğ¸ÑĞº ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸...",
                overseasUnitLabel: "Ğ¦ĞµĞ½Ğ° Ğ·Ğ°Ñ€ÑƒĞ±ĞµĞ¶Ğ½Ğ¾Ğ³Ğ¾ ÑĞºĞ»Ğ°Ğ´Ğ° (â‚¸/Ğ¼Â³)",
                firstmileUnitLabel: "Ğ¦ĞµĞ½Ğ° Ğ¿ĞµÑ€Ğ²Ğ¾Ğ¹ Ğ¼Ğ¸Ğ»Ğ¸ (â‚¸/Ğ¼Â³)"
            }
        };

        // å•†å“åˆ†ç±»æ•°æ®
        const categories = [
            { id: "auto-cards", name: { zh: "æ±½è½¦åç‰‡", ru: "ĞĞ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ğ¸Ğ·Ğ¸Ñ‚ĞºĞ¸" }, commission: 0.12 },
            { id: "watch-straps", name: { zh: "æ‰‹è¡¨å¸¦", ru: "Ğ®Ğ²ĞµĞ»Ğ¸Ñ€Ğ½Ñ‹Ğµ Ñ€ĞµĞ¼ĞµÑˆĞºĞ¸ Ğ¸ Ğ±Ñ€Ğ°ÑĞ»ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ Ñ‡Ğ°ÑĞ¾Ğ²" }, commission: 0.15 },
            { id: "electronics", name: { zh: "ç”µå­äº§å“", ru: "Ğ­Ğ»ĞµĞºÑ‚Ñ€Ğ¾Ğ½Ğ¸ĞºĞ°" }, commission: 0.10 },
            { id: "home-appliances", name: { zh: "å®¶ç”¨ç”µå™¨", ru: "Ğ‘Ñ‹Ñ‚Ğ¾Ğ²Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸ĞºĞ°" }, commission: 0.08 },
            { id: "clothing", name: { zh: "æœè£…", ru: "ĞĞ´ĞµĞ¶Ğ´Ğ°" }, commission: 0.18 }
        ];

        // æ‰å¹³åŒ–åˆ†ç±»æ•°æ®ç”¨äºæœç´¢
        let flatCategories = [];

        function flattenCategories(categories, level = 1, parentPath = "") {
            categories.forEach(cat => {
                const path = parentPath ? `${parentPath} > ${cat.name.zh}` : cat.name.zh;
                flatCategories.push({
                    id: cat.id,
                    name: cat.name,
                    commission: cat.commission,
                    level: level,
                    path: path
                });
            });
        }

        flattenCategories(categories);

        document.addEventListener('DOMContentLoaded', function () {
            // åˆå§‹åŒ–å˜é‡
            let currentLanguage = 'zh';
            let currentCurrency = 'cny';
            let currentCommission = 0.12; // é»˜è®¤ä½£é‡‘ç‡

            // è·å–DOMå…ƒç´ 
            const exchangeRate = document.getElementById('exchangeRate');
            const purchasePrice = document.getElementById('purchasePrice');
            const shippingCost = document.getElementById('shippingCost');
            const profitMargin = document.getElementById('profitMargin');
            const cashback = document.getElementById('cashback');
            const paymentMethod = document.getElementById('paymentMethod');
            const length = document.getElementById('length');
            const width = document.getElementById('width');
            const height = document.getElementById('height');
            const volume = document.getElementById('volume');
            const weight = document.getElementById('weight');
            const kaspiPriceCny = document.getElementById('kaspiPriceCny');
            const kaspiPriceKzt = document.getElementById('kaspiPriceKzt');
            const overseasWarehouse = document.getElementById('overseasWarehouse');
            const firstMile = document.getElementById('firstMile');
            const cashbackAmount = document.getElementById('cashbackAmount');
            const kaspiShipping = document.getElementById('kaspiShipping');
            const platformFee = document.getElementById('platformFee');
            const withdrawalTax = document.getElementById('withdrawalTax');
            const withdrawalFee = document.getElementById('withdrawalFee');
            const exchangeLoss = document.getElementById('exchangeLoss');
            const remittanceFee = document.getElementById('remittanceFee');
            const kaspiPayAmount = document.getElementById('kaspiPayAmount');
            const returnAmountDisplay = document.getElementById('returnAmountDisplay');
            const estimatedAmount = document.getElementById('estimatedAmount');
            const profit = document.getElementById('profit');
            const calculateBtn = document.getElementById('calculateBtn');
            const commissionDisplay = document.getElementById('commission-display');
            const container = document.querySelector('.container');
            
            // æ–°å¢å…ƒç´ 
            const overseasUnitPrice = document.getElementById('overseasUnitPrice');
            const firstMileUnitPrice = document.getElementById('firstMileUnitPrice');
            const overseasToggle = document.getElementById('overseasToggle');
            const firstMileToggle = document.getElementById('firstMileToggle');
            const withdrawalFeeToggle = document.getElementById('withdrawalFeeToggle');
            const exchangeLossToggle = document.getElementById('exchangeLossToggle');
            const remittanceFeeToggle = document.getElementById('remittanceFeeToggle');

            // é”™è¯¯æ¶ˆæ¯å…ƒç´ 
            const exchangeError = document.getElementById('exchange-error');
            const purchaseError = document.getElementById('purchase-error');
            const shippingError = document.getElementById('shipping-error');
            const profitError = document.getElementById('profit-error');
            const weightError = document.getElementById('weight-error');

            // åˆ†ç±»é€‰æ‹©å™¨
            const categorySelect = document.getElementById('category-select');
            const categorySearch = document.getElementById('category-search');
            const searchResults = document.getElementById('search-results');

            // è´§å¸é€‰æ‹©å™¨
            const currencyCny = document.getElementById('currency-cny');
            const currencyKzt = document.getElementById('currency-kzt');

            // åˆå§‹åŒ–åˆ†ç±»é€‰æ‹©å™¨
            function populateCategorySelect(selectElement, categories, placeholder) {
                // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                const selectedValue = selectElement.value;
                
                selectElement.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = placeholder;
                defaultOption.dataset.commission = '';
                selectElement.appendChild(defaultOption);

                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name[currentLanguage];
                    option.dataset.commission = cat.commission;
                    selectElement.appendChild(option);
                });
                
                // æ¢å¤é€‰ä¸­çš„å€¼
                if (selectedValue) {
                    selectElement.value = selectedValue;
                }
            }

            // å¡«å……å•†å“åˆ†ç±»
            populateCategorySelect(categorySelect, categories, currentLanguage === 'zh' ? '-- è¯·é€‰æ‹©å•†å“åˆ†ç±» --' : '-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° --');

            // åˆ†ç±»é€‰æ‹©å˜åŒ–äº‹ä»¶
            categorySelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                currentCommission = parseFloat(selectedOption.dataset.commission) || 0.12;
                
                // æ›´æ–°ä½£é‡‘æ˜¾ç¤º
                const trans = translations[currentLanguage];
                commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
                
                // é‡æ–°è®¡ç®—
                calculateAll();
            });

            // åˆ†ç±»æœç´¢åŠŸèƒ½
            categorySearch.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                if (!searchTerm) {
                    searchResults.style.display = 'none';
                    return;
                }

                const results = flatCategories.filter(cat =>
                    cat.name.zh.toLowerCase().includes(searchTerm) ||
                    cat.name.ru.toLowerCase().includes(searchTerm)
                );

                if (results.length === 0) {
                    searchResults.style.display = 'none';
                    return;
                }

                searchResults.innerHTML = '';
                results.forEach(cat => {
                    const div = document.createElement('div');
                    div.className = 'search-result-item';
                    div.textContent = currentLanguage === 'zh' ? cat.path : cat.name.ru;
                    div.dataset.id = cat.id;
                    div.dataset.commission = cat.commission;
                    div.dataset.level = cat.level;
                    searchResults.appendChild(div);
                });

                searchResults.style.display = 'block';
            });

            // å¤„ç†æœç´¢ç»“æœé€‰æ‹©
            searchResults.addEventListener('click', function (e) {
                if (e.target.classList.contains('search-result-item')) {
                    const catId = e.target.dataset.id;
                    const commission = e.target.dataset.commission;
                    
                    // è®¾ç½®ä½£é‡‘ç‡
                    currentCommission = parseFloat(commission) || 0.12;
                    
                    // æ›´æ–°ä½£é‡‘æ˜¾ç¤º
                    const trans = translations[currentLanguage];
                    commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
                    
                    // æŸ¥æ‰¾å¹¶è®¾ç½®åˆ†ç±»
                    const foundCategory = flatCategories.find(cat => cat.id === catId);
                    if (foundCategory) {
                        categorySelect.value = catId;
                    }

                    categorySearch.value = '';
                    searchResults.style.display = 'none';
                    
                    // é‡æ–°è®¡ç®—
                    calculateAll();
                }
            });

            // ç‚¹å‡»æœç´¢å›¾æ ‡èšç„¦æœç´¢æ¡†
            document.querySelector('.search-icon').addEventListener('click', function () {
                categorySearch.focus();
            });

            // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const oldLanguage = currentLanguage;
                    currentLanguage = this.dataset.lang;
                    
                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°bodyç±»å
                    document.body.className = '';
                    document.body.classList.add(`lang-${currentLanguage}`);

                    // æ›´æ–°é¡µé¢æ–‡æœ¬
                    updateLanguage();
                    
                    // è½¬æ¢è´§å¸å€¼
                    const rate = parseFloat(exchangeRate.value) || 70;
                    
                    // éœ€è¦è½¬æ¢çš„å­—æ®µ
                    const fieldsToConvert = [
                        purchasePrice, 
                        shippingCost,
                        overseasUnitPrice,
                        firstMileUnitPrice
                    ];
                    
                    fieldsToConvert.forEach(field => {
                        const value = parseFloat(field.value);
                        if (!isNaN(value)) {
                            if (oldLanguage === 'zh' && currentLanguage === 'ru') {
                                // äººæ°‘å¸ â†’ åšæˆˆ
                                field.value = (value * rate).toFixed(2);
                            } else if (oldLanguage === 'ru' && currentLanguage === 'zh') {
                                // åšæˆˆ â†’ äººæ°‘å¸
                                field.value = (value / rate).toFixed(2);
                            }
                        }
                    });
                    
                    // åˆå§‹åŒ–æ–°è¯­è¨€çš„é»˜è®¤å•ä»·
                    initializeDefaultPrices();
                    
                    // æ›´æ–°æ”¯ä»˜æ–¹å¼é€‰é¡¹
                    if (currentLanguage === 'ru') {
                        paymentMethod.innerHTML = '<option value="kaspi">Kaspi.kz</option>';
                        currencyKzt.checked = true;
                        currentCurrency = 'kzt';
                    } else {
                        // æ¢å¤ä¸­æ–‡æ”¯ä»˜æ–¹å¼é€‰é¡¹
                        paymentMethod.innerHTML = `
                            <option value="publicToPublic">é“¶è¡Œå…¬å¯¹å…¬</option>
                            <option value="publicToPrivate">é“¶è¡Œå…¬å¯¹ç§</option>
                            <option value="privateToPrivate">é“¶è¡Œç§å¯¹ç§</option>
                            <option value="wechat">å¾®ä¿¡</option>
                            <option value="alipay">æ”¯ä»˜å®</option>
                            <option value="kaspi">Kaspi.kz</option>
                        `;
                        currencyCny.checked = true;
                        currentCurrency = 'cny';
                    }
                    
                    // é‡æ–°è®¡ç®—
                    calculateAll();
                });
            });

            // è´§å¸åˆ‡æ¢åŠŸèƒ½
            document.querySelectorAll('.currency-radio').forEach(radio => {
                radio.addEventListener('change', function () {
                    currentCurrency = this.value;
                    calculateAll(); // é‡æ–°è®¡ç®—å¹¶æ˜¾ç¤ºç»“æœ
                });
            });

            // æ›´æ–°é¡µé¢è¯­è¨€
            function updateLanguage() {
                const trans = translations[currentLanguage];

                // æ›´æ–°æ–‡æœ¬å†…å®¹
                document.getElementById('company-name').textContent = trans.companyName;
                document.getElementById('app-title').textContent = trans.appTitle;
                document.getElementById('exchange-label').textContent = trans.exchangeLabel;
                document.getElementById('currency-label').textContent = trans.currencyLabel;
                document.getElementById('product-info-title').textContent = trans.productInfo;
                document.getElementById('category-label').textContent = trans.categoryLabel;
                document.getElementById('purchase-label').textContent = trans.purchaseLabel;
                document.getElementById('shipping-label').textContent = trans.shippingLabel;
                document.getElementById('profit-label').textContent = trans.profitLabel;
                document.getElementById('cashback-label').textContent = trans.cashbackLabel;
                document.getElementById('payment-label').textContent = trans.paymentLabel;
                document.getElementById('logistics-title').textContent = trans.logisticsTitle;
                document.getElementById('dimension-label').textContent = trans.dimensionLabel;
                document.getElementById('volume-label').textContent = trans.volumeLabel;
                document.getElementById('weight-label').textContent = trans.weightLabel;
                document.getElementById('kaspi-price-label').textContent = trans.kaspiPriceLabel;
                document.getElementById('fees-title').textContent = trans.feesTitle;
                document.getElementById('overseas-label').textContent = trans.overseasLabel;
                document.getElementById('firstmile-label').textContent = trans.firstmileLabel;
                document.getElementById('platform-title').textContent = trans.platformTitle;
                document.getElementById('cashback-amount-label').textContent = trans.cashbackAmountLabel;
                document.getElementById('kaspi-shipping-label').textContent = trans.kaspiShippingLabel;
                document.getElementById('platform-fee-label').textContent = trans.platformFeeLabel;
                document.getElementById('withdrawal-tax-label').textContent = trans.withdrawalTaxLabel;
                document.getElementById('return-title').textContent = trans.returnTitle;
                document.getElementById('withdrawal-fee-label').textContent = trans.withdrawalFeeLabel;
                document.getElementById('exchange-loss-label').textContent = trans.exchangeLossLabel;
                document.getElementById('remittance-fee-label').textContent = trans.remittanceFeeLabel;
                document.getElementById('return-amount-label').textContent = trans.returnAmountLabel;
                document.getElementById('kaspi-pay-label').textContent = trans.kaspiPayLabel;
                document.getElementById('estimated-amount-label').textContent = trans.estimatedAmountLabel;
                document.getElementById('profit-label-final').textContent = trans.profitLabelFinal;
                document.getElementById('copyright').textContent = trans.copyright;
                document.getElementById('cny-label').textContent = trans.cnyLabel;
                document.getElementById('kzt-label').textContent = trans.kztLabel;
                
                document.getElementById('kaspi-price-cny-label').textContent = trans.kaspiPriceCnyLabel;
                document.getElementById('kaspi-price-kzt-label').textContent = trans.kaspiPriceKztLabel;
    document.getElementById('overseas-unit-label').textContent = trans.overseasUnitLabel;
                document.getElementById('firstmile-unit-label').textContent = trans.firstmileUnitLabel;

                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                calculateBtn.textContent = trans.calculateBtn;

                // æ›´æ–°å ä½ç¬¦æ–‡æœ¬
                categorySearch.placeholder = trans.categorySearchPlaceholder;
                purchasePrice.placeholder = trans.purchasePlaceholder;
                shippingCost.placeholder = trans.shippingPlaceholder;
                profitMargin.placeholder = trans.profitPlaceholder;
                cashback.placeholder = trans.cashbackPlaceholder;
                weight.placeholder = trans.weightPlaceholder;
                length.placeholder = trans.lengthPlaceholder;
                width.placeholder = trans.widthPlaceholder;
                height.placeholder = trans.heightPlaceholder;
                exchangeRate.placeholder = trans.exchangePlaceholder;
                
                // æ›´æ–°åˆ†ç±»é€‰æ‹©æ¡†
                populateCategorySelect(categorySelect, categories, currentLanguage === 'zh' ? '-- è¯·é€‰æ‹©å•†å“åˆ†ç±» --' : '-- Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ° --');
                
                // æ›´æ–°ä½£é‡‘æ˜¾ç¤º
                commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
            }

            // éªŒè¯è¾“å…¥
            function validateInputs() {
                let isValid = true;
                
                // éšè—æ‰€æœ‰é”™è¯¯æ¶ˆæ¯
                exchangeError.style.display = 'none';
                purchaseError.style.display = 'none';
                shippingError.style.display = 'none';
                profitError.style.display = 'none';
                weightError.style.display = 'none';
                
                // éªŒè¯æ±‡ç‡
                const rate = parseFloat(exchangeRate.value);
                if (isNaN(rate)) { 
                    exchangeError.textContent = currentLanguage === 'zh' ? 'è¯·è¾“å…¥æ±‡ç‡' : 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºÑƒÑ€Ñ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°';
                    exchangeError.style.display = 'block';
                    isValid = false;
                } else if (rate <= 0) {
                    exchangeError.textContent = currentLanguage === 'zh' ? 'æ±‡ç‡å¿…é¡»å¤§äº0' : 'ĞšÑƒÑ€Ñ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ±Ñ‹Ñ‚ÑŒ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ 0';
                    exchangeError.style.display = 'block';
                    isValid = false;
                }
                
                // éªŒè¯é‡‡è´­ä»·
                const purchase = parseFloat(purchasePrice.value);
                if (isNaN(purchase) || purchase < 0) { 
                    purchaseError.textContent = currentLanguage === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‡‡è´­ä»·' : 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ Ğ·Ğ°ĞºÑƒĞ¿Ğ¾Ñ‡Ğ½ÑƒÑ Ñ†ĞµĞ½Ñƒ';
                    purchaseError.style.display = 'block';
                    isValid = false;
                }
                
                // éªŒè¯è¿è´¹
                const shipping = parseFloat(shippingCost.value);
                if (isNaN(shipping) || shipping < 0) { 
                    shippingError.textContent = currentLanguage === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„è¿è´¹' : 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ¸';
                    shippingError.style.display = 'block';
                    isValid = false;
                }
                
                // éªŒè¯åˆ©æ¶¦ç‡
                const margin = parseFloat(profitMargin.value);
                if (isNaN(margin) || margin < 0) { 
                    profitError.textContent = currentLanguage === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„åˆ©æ¶¦ç‡' : 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ Ğ¼Ğ°Ñ€Ğ¶Ñƒ Ğ¿Ñ€Ğ¸Ğ±Ñ‹Ğ»Ğ¸';
                    profitError.style.display = 'block';
                    isValid = false;
                }
                
                // éªŒè¯é‡é‡
                const w = parseFloat(weight.value);
                if (isNaN(w) || w <= 0) { 
                    weightError.textContent = currentLanguage === 'zh' ? 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‡é‡' : 'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ²ĞµÑ';
                    weightError.style.display = 'block';
                    isValid = false;
                }
                
                return isValid;
            }

            // è®¡ç®—ä½“ç§¯
            function calculateVolume() {
                const l = parseFloat(length.value) || 0;
                const w = parseFloat(width.value) || 0;
                const h = parseFloat(height.value) || 0;

                if (l > 0 && w > 0 && h > 0) {
                    const vol = (l / 100) * (w / 100) * (h / 100);
                    volume.value = vol.toFixed(4) + ' mÂ³';
                    return vol;
                }

                volume.value = '';
                return 0;
            }

            // è®¡ç®—æ‰€æœ‰è´¹ç”¨å¹¶æ˜¾ç¤ºç»“æœ
            function calculateAll() {
                // éªŒè¯è¾“å…¥
                if (!validateInputs()) {
                    return;
                }
                
                // è·å–è¾“å…¥å€¼
                const rate = parseFloat(exchangeRate.value);
                const purchase = parseFloat(purchasePrice.value) || 0;
                const shipping = parseFloat(shippingCost.value) || 0;
                const margin = parseFloat(profitMargin.value) || 0;
                const cb = parseFloat(cashback.value) || 0;
                const w = parseFloat(weight.value) || 0;
                const vol = calculateVolume();
                const cat = currentCommission;
                
                // è·å–è´¹ç”¨å•ä»·
                const overseasUnit = parseFloat(overseasUnitPrice.value) || 1000;
                const firstMileUnit = parseFloat(firstMileUnitPrice.value) || 100;

                // è®¡ç®—Kaspiå”®ä»·ï¼ˆäººæ°‘å¸ï¼‰
                let kaspiPriceCnyValue;
                if (currentLanguage === 'ru') {
                    // ä¿„è¯­ç•Œé¢ï¼šé‡‡è´­ä»·å’Œè¿è´¹æ˜¯åšæˆˆï¼Œéœ€è¦è½¬æ¢ä¸ºäººæ°‘å¸
                    kaspiPriceCnyValue = (purchase + shipping) * (1 + margin / 100) / rate;
                } else {
                    // ä¸­æ–‡ç•Œé¢ï¼šé‡‡è´­ä»·å’Œè¿è´¹æ˜¯äººæ°‘å¸
                    kaspiPriceCnyValue = (purchase + shipping) * (1 + margin / 100);
                }

                // è®¡ç®—Kaspiå”®ä»·ï¼ˆåšæˆˆï¼‰
                const kaspiPriceKztValue = kaspiPriceCnyValue * rate;

                // æ›´æ–°åŒåˆ—Kaspiå”®ä»·æ˜¾ç¤º
                kaspiPriceCny.value = kaspiPriceCnyValue.toFixed(2) + 'Â¥';
                kaspiPriceKzt.value = kaspiPriceKztValue.toFixed(2) + 'â‚¸';

                // === ä¿®æ”¹ç‚¹2ï¼šæµ·å¤–ä»“è´¹ç”¨è®¡ç®—ï¼ˆä¸­æ–‡ç•Œé¢ä¸é™¤æ±‡ç‡ï¼‰===
                let overseasValue = 0;
                if (overseasToggle.checked && vol > 0) {
                    if (vol <= 1) {
                        if (currentLanguage === 'zh') {
                            // ä¸­æ–‡ç•Œé¢ï¼šç›´æ¥ä½¿ç”¨äººæ°‘å¸è®¡ç®—
                            overseasValue = overseasUnit;
                        } else {
                            // ä¿„è¯­ç•Œé¢ï¼šåšæˆˆè½¬äººæ°‘å¸
                            overseasValue = overseasUnit / rate;
                        }
                    } else {
                        if (currentLanguage === 'zh') {
                            // ä¸­æ–‡ç•Œé¢ï¼šç›´æ¥ä½¿ç”¨äººæ°‘å¸è®¡ç®—
                            overseasValue = Math.ceil(vol) * overseasUnit;
                        } else {
                            // ä¿„è¯­ç•Œé¢ï¼šåšæˆˆè½¬äººæ°‘å¸
                            overseasValue = (Math.ceil(vol) * overseasUnit) / rate;
                        }
                    }
                }

                // === ä¿®æ”¹ç‚¹3ï¼šå¤´ç¨‹è´¹ç”¨è®¡ç®—ï¼ˆä¸­æ–‡ç•Œé¢ä¸é™¤æ±‡ç‡ï¼‰===
                let firstMileValue = 0;
                if (firstMileToggle.checked && vol > 0) {
                    if (vol <= 0.01) {
                        if (currentLanguage === 'zh') {
                            // ä¸­æ–‡ç•Œé¢ï¼šç›´æ¥ä½¿ç”¨äººæ°‘å¸è®¡ç®—
                            firstMileValue = firstMileUnit;
                        } else {
                            // ä¿„è¯­ç•Œé¢ï¼šåšæˆˆè½¬äººæ°‘å¸
                            firstMileValue = firstMileUnit / rate;
                        }
                    } else {
                        if (currentLanguage === 'zh') {
                            // ä¸­æ–‡ç•Œé¢ï¼šç›´æ¥ä½¿ç”¨äººæ°‘å¸è®¡ç®—
                            firstMileValue = vol * firstMileUnit;
                        } else {
                            // ä¿„è¯­ç•Œé¢ï¼šåšæˆˆè½¬äººæ°‘å¸
                            firstMileValue = (vol * firstMileUnit) / rate;
                        }
                    }
                }

                // 4. è®¡ç®—ä¸‹å•è¿”åˆ©ï¼ˆäººæ°‘å¸ï¼‰
                const cashbackValue = (cb / 100 * kaspiPriceKztValue) / rate;

                // 5. è®¡ç®—Kaspiè¿è´¹ï¼ˆäººæ°‘å¸ï¼‰
                let kaspiShippingValue = 0;
                if (kaspiPriceKztValue > 0) {
                    if (kaspiPriceKztValue < 5000) {
                        kaspiShippingValue = 0;
                    } else if (kaspiPriceKztValue <= 15000) {
                        kaspiShippingValue = 799 / rate;
                    } else {
                        if (w < 5) {
                            kaspiShippingValue = 1299 / rate;
                        } else if (w <= 15) {
                            kaspiShippingValue = 1699 / rate;
                        } else if (w <= 50) {
                            kaspiShippingValue = 3599 / rate;
                        } else {
                            kaspiShippingValue = 6499 / rate;
                        }
                    }
                }

                // 6. è®¡ç®—å¹³å°ä½£é‡‘ï¼ˆäººæ°‘å¸ï¼‰
                const platformFeeValue = (kaspiPriceKztValue * cat) / rate;

                // 7. è®¡ç®—æç°ç¨ï¼ˆ4%ï¼‰ï¼ˆäººæ°‘å¸ï¼‰
                const baseAmount = kaspiPriceKztValue / rate;
                const withdrawalTaxValue = (baseAmount - cashbackValue - kaspiShippingValue - platformFeeValue) * 0.04;

                // 8. è®¡ç®—Kaspi payæç°åˆ°è´¦é‡‘é¢ï¼ˆäººæ°‘å¸ï¼‰
                const kaspiPayAmountValue = baseAmount - cashbackValue - kaspiShippingValue - platformFeeValue - withdrawalTaxValue;

                // 9. è®¡ç®—æç°æ‰‹ç»­è´¹ï¼ˆ1%ï¼‰ï¼ˆäººæ°‘å¸ï¼‰ - è€ƒè™‘å¼€å…³çŠ¶æ€
                let withdrawalFeeValue = 0;
                if (withdrawalFeeToggle.checked) {
                    withdrawalFeeValue = kaspiPayAmountValue * 0.01;
                }

                // 10. è®¡ç®—å›æ¬¾é‡‘é¢ï¼ˆäººæ°‘å¸ï¼‰
                const returnAmountValue = kaspiPayAmountValue - withdrawalFeeValue - overseasValue - firstMileValue;

                // 11. è®¡ç®—æ±‡æŸï¼ˆ1.42%ï¼‰ï¼ˆäººæ°‘å¸ï¼‰ - è€ƒè™‘å¼€å…³çŠ¶æ€
                let exchangeLossValue = 0;
                if (exchangeLossToggle.checked) {
                    exchangeLossValue = returnAmountValue * 0.0142;
                }

                // 12. è®¡ç®—æ±‡æ¬¾æ‰‹ç»­è´¹ï¼ˆäººæ°‘å¸ï¼‰ - è€ƒè™‘å¼€å…³çŠ¶æ€
                let remittanceFeeValue = 0;
                if (remittanceFeeToggle.checked && returnAmountValue > 0) {
                    const method = paymentMethod.value;
                    switch (method) {
                        case 'publicToPublic':
                            if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 100000) {
                                remittanceFeeValue = 10;
                            } else if (returnAmountValue <= 500000) {
                                remittanceFeeValue = 15;
                            } else if (returnAmountValue <= 1000000) {
                                remittanceFeeValue = 20;
                            } else {
                                remittanceFeeValue = Math.min(200, Math.ceil(returnAmountValue * 0.00002 * 100) / 100);
                            }
                            break;
                        case 'publicToPrivate':
                            if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 100000) {
                                remittanceFeeValue = 10;
                            } else if (returnAmountValue <= 500000) {
                                remittanceFeeValue = 15;
                            } else if (returnAmountValue <= 1000000) {
                                remittanceFeeValue = 20;
                            } else {
                                remittanceFeeValue = Math.min(200, Math.ceil(returnAmountValue * 0.00002 * 100) / 100);
                            }
                            break;
                        case 'privateToPrivate':
                            if (returnAmountValue <= 5000) {
                                remittanceFeeValue = 0;
                            } else if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 50000) {
                                remittanceFeeValue = 7.5;
                            } else {
                                remittanceFeeValue = Math.min(25, Math.ceil(returnAmountValue * 0.00015 * 100) / 100);
                            }
                            break;
                        case 'wechat':
                            remittanceFeeValue = Math.max(0.1, Math.ceil(returnAmountValue * 0.001 * 100) / 100);
                            break;
                        case 'alipay':
                            remittanceFeeValue = Math.max(0.1, Math.ceil(returnAmountValue * 0.001 * 100) / 100);
                            break;
                        case 'kaspi':
                            remittanceFeeValue = 0;
                            break;
                        default:
                            remittanceFeeValue = 0;
                    }
                }

                // 13. è®¡ç®—é¢„ä¼°åˆ°è´¦é‡‘é¢ï¼ˆäººæ°‘å¸ï¼‰
                const estimatedAmountValue = returnAmountValue - exchangeLossValue - remittanceFeeValue;

                // 14. è®¡ç®—åˆ©æ¶¦
                let profitValue;
                if (currentLanguage === 'ru') {
                    // ä¿„è¯­ç•Œé¢:è¾“å…¥å€¼æ˜¯åšæˆˆ,éœ€è¦è½¬æ¢ä¸ºäººæ°‘å¸
                    const purchaseInCNY = purchase / rate;
                    const shippingInCNY = shipping / rate;
                    profitValue = estimatedAmountValue - purchaseInCNY - shippingInCNY;
                } else {
                    // ä¸­æ–‡ç•Œé¢:è¾“å…¥å€¼å·²ç»æ˜¯äººæ°‘å¸
                    profitValue = estimatedAmountValue - purchase - shipping;
                }

                // æ˜¾ç¤ºç»“æœæ—¶çš„è´§å¸è½¬æ¢
                const currencyRate = currentCurrency === 'kzt' ? rate : 1;
                const currencySymbol = currentCurrency === 'kzt' ? 'â‚¸' : 'Â¥';

                // æ›´æ–°æ˜¾ç¤ºç»“æœ
                overseasWarehouse.value = (overseasValue * currencyRate).toFixed(2) + currencySymbol;
                firstMile.value = (firstMileValue * currencyRate).toFixed(2) + currencySymbol;
                cashbackAmount.value = (cashbackValue * currencyRate).toFixed(2) + currencySymbol;
                kaspiShipping.value = (kaspiShippingValue * currencyRate).toFixed(2) + currencySymbol;
                platformFee.value = (platformFeeValue * currencyRate).toFixed(2) + currencySymbol;
                withdrawalTax.value = (withdrawalTaxValue * currencyRate).toFixed(2) + currencySymbol;
                withdrawalFee.value = (withdrawalFeeValue * currencyRate).toFixed(2) + currencySymbol;
                exchangeLoss.value = (exchangeLossValue * currencyRate).toFixed(2) + currencySymbol;
                remittanceFee.value = (remittanceFeeValue * currencyRate).toFixed(2) + currencySymbol;
                kaspiPayAmount.textContent = (kaspiPayAmountValue * currencyRate).toFixed(2) + currencySymbol;
                returnAmountDisplay.textContent = (returnAmountValue * currencyRate).toFixed(2) + currencySymbol;
                estimatedAmount.textContent = (estimatedAmountValue * currencyRate).toFixed(2) + currencySymbol;
                profit.textContent = (profitValue * currencyRate).toFixed(2) + currencySymbol;

                // æ ¹æ®åˆ©æ¶¦å€¼è®¾ç½®é¢œè‰²
                if (profitValue > 0) {
                    profit.style.color = '#27ae60';
                } else if (profitValue < 0) {
                    profit.style.color = '#c0392b';
                } else {
                    profit.style.color = '#e65100';
                }
                
                // æ›´æ–°å¼€å…³æ ‡ç­¾çŠ¶æ€
                updateToggleLabels();
            }
            
            // æ›´æ–°å¼€å…³æ ‡ç­¾çŠ¶æ€
            function updateToggleLabels() {
                const toggles = [
                    { toggle: overseasToggle, label: document.querySelector('#overseas-label') },
                    { toggle: firstMileToggle, label: document.querySelector('#firstmile-label') },
                    { toggle: withdrawalFeeToggle, label: document.querySelector('#withdrawal-fee-label') },
                    { toggle: exchangeLossToggle, label: document.querySelector('#exchange-loss-label') },
                    { toggle: remittanceFeeToggle, label: document.querySelector('#remittance-fee-label') }
                ];
                
                toggles.forEach(item => {
                    if (item.toggle.checked) {
                        item.label.classList.remove('toggle-off');
                    } else {
                        item.label.classList.add('toggle-off');
                    }
                });
            }

            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            calculateBtn.addEventListener('click', calculateAll);
            
            // å¼€å…³å˜åŒ–æ—¶é‡æ–°è®¡ç®—
            overseasToggle.addEventListener('change', calculateAll);
            firstMileToggle.addEventListener('change', calculateAll);
            withdrawalFeeToggle.addEventListener('change', calculateAll);
            exchangeLossToggle.addEventListener('change', calculateAll);
            remittanceFeeToggle.addEventListener('change', calculateAll);
            
            // è´¹ç”¨å•ä»·å˜åŒ–æ—¶é‡æ–°è®¡ç®—
            overseasUnitPrice.addEventListener('input', calculateAll);
            firstMileUnitPrice.addEventListener('input', calculateAll);

            // å°ºå¯¸å˜åŒ–æ—¶è‡ªåŠ¨è®¡ç®—ä½“ç§¯
            length.addEventListener('input', calculateVolume);
            width.addEventListener('input', calculateVolume);
            height.addEventListener('input', calculateVolume);
            
            // è¾“å…¥å˜åŒ–æ—¶éšè—é”™è¯¯æ¶ˆæ¯
            exchangeRate.addEventListener('input', () => exchangeError.style.display = 'none');
            purchasePrice.addEventListener('input', () => purchaseError.style.display = 'none');
            shippingCost.addEventListener('input', () => shippingError.style.display = 'none');
            profitMargin.addEventListener('input', () => profitError.style.display = 'none');
            weight.addEventListener('input', () => weightError.style.display = 'none');

            // åˆå§‹åŒ–é»˜è®¤å•ä»·ï¼ˆåŸºäºå½“å‰è¯­è¨€ï¼‰
            function initializeDefaultPrices() {
                const rate = parseFloat(exchangeRate.value) || 70;
                
                if (currentLanguage === 'zh') {
                    // ä¸­æ–‡ï¼šè®¾ç½®äººæ°‘å¸é»˜è®¤å€¼
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = (1000 / rate).toFixed(2);
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = (100 / rate).toFixed(2);
                    }
                } else {
                    // ä¿„è¯­ï¼šè®¾ç½®åšæˆˆé»˜è®¤å€¼
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = '1000';
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = '100';
                    }
                }
            }

            // å½“æ±‡ç‡å˜åŒ–æ—¶æ›´æ–°ä¸­æ–‡ç•Œé¢çš„é»˜è®¤å•ä»·
            exchangeRate.addEventListener('input', function() {
                if (currentLanguage === 'zh') {
                    const rate = parseFloat(this.value) || 70;
                    
                    // åªæ›´æ–°æœªä¿®æ”¹è¿‡çš„é»˜è®¤å€¼
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = (1000 / rate).toFixed(2);
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = (100 / rate).toFixed(2);
                    }
                    
                    calculateAll();
                }
            });

            // æ ‡è®°ç”¨æˆ·æ˜¯å¦ä¿®æ”¹è¿‡å•ä»·
            overseasUnitPrice.addEventListener('input', function() {
                this.dataset.userSet = 'true';
            });

            firstMileUnitPrice.addEventListener('input', function() {
                this.dataset.userSet = 'true';
            });

            // åˆå§‹åŒ–é¡µé¢
            function initializePage() {
                updateLanguage();
                initializeDefaultPrices();
                calculateVolume();
                calculateAll();
            }

            // åœ¨DOMContentLoadedäº‹ä»¶çš„æœ€åè°ƒç”¨åˆå§‹åŒ–å‡½æ•°
            initializePage();
        });
    </script>
</body>
</html>
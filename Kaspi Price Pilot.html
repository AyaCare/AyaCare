<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Kaspi 电商利润计算器增强版（优化版）</title>
<style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            padding: 10px;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #ff8c00, #ffd700, #ff8c00);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 15px;
            padding-top: 40px;
        }

        .header h1 {
            font-size: 24px;
            color: #1a2a6c;
            margin-bottom: 8px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .header h2 {
            font-size: 18px;
            color: #d35400;
            font-weight: 600;
        }

        .header::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 3px;
            background: linear-gradient(90deg, #1a2a6c, #3498db, #1a2a6c);
            border-radius: 2px;
        }

        .exchange-rate {
            background-color: #e3f2fd;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid #bbdefb;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        .exchange-rate label {
            font-weight: bold;
            color: #0d47a1;
            font-size: 16px;
            white-space: nowrap;
        }

        .exchange-rate input {
            font-size: 16px;
            padding: 8px 12px;
            border: 2px solid #64b5f6;
            border-radius: 8px;
            width: 150px;
            text-align: center;
            color: #1565c0;
            font-weight: bold;
            background-color: #fff;
            margin: 0;
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .section {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }

        .section-title {
            font-size: 18px;
            color: #1a2a6c;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .form-control:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .form-control::placeholder {
            color: #aaa;
            font-style: italic;
        }
        
        .error-message {
            color: #e74c3c;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }

        .dimensions {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
        }
        
        /* 新增Kaspi售价双列样式 */
        .kaspi-price-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .kaspi-price-box {
            display: flex;
            flex-direction: column;
        }
        
        .kaspi-price-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 4px;
        }

        .output-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .output-group {
            background-color: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 1px solid #c8e6c9;
        }

        .output-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #2e7d32;
            font-size: 14px;
        }

        .output-value {
            font-size: 16px;
            font-weight: bold;
            color: #1b5e20;
            background-color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #a5d6a7;
            text-align: right;
        }

        .results-section {
            background-color: #fffde7;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #ffe082;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .result-item {
            padding: 12px;
            border-radius: 8px;
            background-color: #fff9c4;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-item.final {
            background-color: #ffecb3;
            padding: 16px;
            font-weight: bold;
        }

        .result-label {
            font-weight: 600;
            color: #5d4037;
            font-size: 15px;
        }

        .result-value {
            font-size: 18px;
            font-weight: bold;
            color: #e65100;
            min-width: 100px;
            text-align: right;
        }

        .btn-calculate {
            display: block;
            width: 100%;
            padding: 14px;
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-calculate:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-calculate:active {
            transform: translateY(1px);
        }

        .footer {
            text-align: center;
            margin-top: 15px;
            color: #7f8c8d;
            font-size: 13px;
            padding-top: 12px;
            border-top: 1px solid #ecf0f1;
        }

        .category-container {
            position: relative;
        }

        .category-levels {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .category-search {
            position: relative;
        }

        .category-search input {
            padding-right: 40px;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #7f8c8d;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: none;
        }

        .search-result-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
        }

        .search-result-item:hover {
            background-color: #f0f8ff;
        }

        .language-switcher {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .lang-btn {
            background: #1a2a6c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 13px;
        }

        .lang-btn.active {
            background: #ff8c00;
            transform: scale(1.05);
        }

        .currency-selector {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .currency-option {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .currency-radio {
            margin-right: 6px;
        }

        .currency-label {
            font-weight: 500;
            font-size: 14px;
        }

        /* 开关样式 */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
            padding: 8px 0;
            border-top: 1px dashed #e0e0e0;
        }

        .switch-label {
            font-size: 14px;
            color: #555;
            font-weight: 500;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:focus + .slider {
            box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(23px);
        }

        /* 费用单价容器样式 */
        .cost-price-container {
            display: grid;
            grid-template-columns: 1fr; 
            gap: 8px;
            margin-top: 12px;
            background: #f5f9ff; 
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e3f2fd;
        }

        .cost-price-group {
            background: #fff; 
            padding: 10px 12px;
            border-radius: 8px;
            border: 1px solid #bbdefb;
            transition: all 0.3s ease;
        }

        .cost-price-group:hover {
            border-color: #64b5f6;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.1);
        }

        .cost-price-group label {
            display: block;
            margin-bottom: 6px;
            font-size: 13px;
            color: #1976d2;
            font-weight: 500;
        }

        .cost-price-group input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e3f2fd;
            border-radius: 6px;
            font-size: 14px;
            color: #0d47a1;
            background: #fff;
            transition: all 0.3s ease;
        }

        .cost-price-group input:focus {
            border-color: #2196f3;
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        /* 新增样式 */
        .commission-display {
            margin-top: 5px;
            font-size: 13px;
            color: #3498db;
            font-weight: 500;
        }
        
        /* 俄语界面样式 */
        .lang-ru .purchase-label::after,
        .lang-ru .shipping-label::after {
            content: " (¥)";
        }
        
        .lang-ru .form-control::placeholder {
            font-style: normal;
        }
        
        .toggle-off {
            color: #e74c3c;
            font-weight: bold;
        }
        
        /* 移动端优化 */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 20px;
            }
            
            .header h2 {
                font-size: 16px;
            }
            
            .exchange-rate {
                flex-direction: column;
                align-items: center;
                gap: 6px;
            }
            
            .exchange-rate label {
                font-size: 14px;
            }
            
            .exchange-rate input {
                width: 100%;
                max-width: 200px;
            }
            
            .dimensions {
                grid-template-columns: 1fr 1fr 1fr;
            }
            
            .section {
                padding: 12px;
            }
            
            .section-title {
                font-size: 16px;
            }
            
            .btn-calculate {
                padding: 12px;
                font-size: 16px;
                margin: 15px 0;
            }
            
            .result-label, .result-value {
                font-size: 14px;
            }
            
            .result-value {
                min-width: 80px;
                font-size: 16px;
            }
            
            .currency-selector {
                flex-direction: column;
                gap: 8px;
            }
            
            .language-switcher {
                top: 5px;
                right: 5px;
            }
            
            .lang-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
            
            .results-section {
                padding: 15px;
            }
            
            .kaspi-price-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* 平板优化 */
        @media (min-width: 481px) and (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
            
            .output-section {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header {
                padding-top: 30px;
            }
            
            .header h1 {
                font-size: 22px;
            }
            
            .header h2 {
                font-size: 17px;
            }
            
            .dimensions {
                grid-template-columns: 1fr 1fr 1fr;
                gap: 10px;
            }
        }
        
        /* 桌面优化 */
        @media (min-width: 769px) {
            .input-section {
                grid-template-columns: 1fr 1fr;
            }
            
            .output-section {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* 避免移动端键盘弹出时遮挡输入框 */
        @media (max-height: 600px) and (orientation: landscape) {
            .container {
                max-height: 95vh;
                overflow-y: auto;
            }
        }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1 id="company-name">新疆航贸通国际供应链有限公司</h1>
<h2 id="app-title">Kaspi 电商利润计算器增强版</h2>
<div class="language-switcher">
<button class="lang-btn active" data-lang="zh">中文</button>
<button class="lang-btn" data-lang="ru">Русский</button>
</div>
</div>
<div class="exchange-rate">
<label id="exchange-label">当前汇率：1元人民币兑换</label>
<input id="exchangeRate" min="0" placeholder="输入汇率" step="0.01" type="number" value="70"/>
<label id="currency-label">哈萨克斯坦坚戈</label>
<div class="error-message" id="exchange-error">汇率必须大于0</div>
</div>
<div class="input-section">
<div class="section">
<h3 class="section-title" id="product-info-title">产品信息</h3>
<div class="form-group category-container">
<label for="category-search" id="category-label">商品分类</label>
<div class="category-search">
<input autocomplete="off" class="form-control" id="category-search" placeholder="搜索分类..." type="text"/>
<span class="search-icon">🔍</span>
<div class="search-results" id="search-results"></div>
</div>
<select class="form-control" id="category-select">
<option data-commission="" value="">-- 请选择商品分类 --</option>
</select>
<div class="commission-display" id="commission-display">当前佣金率：0%</div>
</div>
<div class="form-group">
<label for="purchasePrice" id="purchase-label">采购价 (¥)</label>
<input class="form-control" id="purchasePrice" min="0" placeholder="输入采购价" step="0.01" type="number" value=""/>
<div class="error-message" id="purchase-error">请输入有效的采购价</div>
</div>
<div class="form-group">
<label for="shippingCost" id="shipping-label">运费 (¥)</label>
<input class="form-control" id="shippingCost" min="0" placeholder="阿拉木图运费" step="0.01" type="number" value=""/>
<div class="error-message" id="shipping-error">请输入有效的运费</div>
</div>
<div class="form-group">
<label id="profit-label">利润率（%）</label>
<input class="form-control" id="profitMargin" min="0" placeholder="输入利润率" step="0.1" type="number" value=""/>
<div class="error-message" id="profit-error">请输入有效的利润率</div>
</div>
<div class="form-group">
<label id="cashback-label">下单返利（%）</label>
<input class="form-control" id="cashback" min="0" placeholder="输入下单返利" step="0.1" type="number" value=""/>
</div>
<div class="form-group">
<label for="paymentMethod" id="payment-label">汇款方式</label>
<select class="form-control" id="paymentMethod">
<option value="publicToPublic">银行公对公</option>
<option value="publicToPrivate">银行公对私</option>
<option value="privateToPrivate">银行私对私</option>
<option value="wechat">微信</option>
<option value="alipay">支付宝</option>
<option value="kaspi">Kaspi.kz</option>
</select>
</div>
</div>
<div class="section">
<h3 class="section-title" id="logistics-title">物流信息</h3>
<div class="form-group">
<label id="dimension-label">尺寸（厘米）</label>
<div class="dimensions">
<div>
<input class="form-control" id="length" min="0.1" placeholder="长" step="0.1" type="number" value=""/>
</div>
<div>
<input class="form-control" id="width" min="0.1" placeholder="宽" step="0.1" type="number" value=""/>
</div>
<div>
<input class="form-control" id="height" min="0.1" placeholder="高" step="0.1" type="number" value=""/>
</div>
</div>
</div>
<div class="form-group">
<label for="volume" id="volume-label">体积（立方米）</label>
<input class="form-control output-value" id="volume" readonly="" type="text"/>
</div>
<div class="form-group">
<label for="weight" id="weight-label">重量（千克）</label>
<input class="form-control" id="weight" min="0.01" placeholder="输入重量" step="0.01" type="number" value=""/>
<div class="error-message" id="weight-error">请输入有效的重量</div>
</div>
<!-- 修改Kaspi售价为双列显示 -->
<div class="form-group">
<label id="kaspi-price-label">Kaspi 售价</label>
<div class="kaspi-price-container">
<div class="kaspi-price-box">
<div class="kaspi-price-label" id="kaspi-price-cny-label">人民币 (¥)</div>
<input class="form-control output-value" id="kaspiPriceCny" readonly="" type="text"/>
</div>
<div class="kaspi-price-box">
<div class="kaspi-price-label" id="kaspi-price-kzt-label">坚戈 (₸)</div>
<input class="form-control output-value" id="kaspiPriceKzt" readonly="" type="text"/>
</div>
</div>
</div>
<!-- 费用单价输入框 -->
<div class="cost-price-container">
<div class="cost-price-group">
<label id="overseas-unit-label">海外仓单价 (¥/m³)</label>
<input id="overseasUnitPrice" min="0" step="1" type="number" value="1000"/>
</div>
<div class="cost-price-group">
<label id="firstmile-unit-label">头程单价 (¥/m³)</label>
<input id="firstMileUnitPrice" min="0" step="1" type="number" value="100"/>
</div>
</div>
</div>
</div>
<button class="btn-calculate" data-ru="Рассчитать прибыль" data-zh="计算利润" id="calculateBtn">计算利润</button>
<div class="output-section">
<div class="section">
<h3 class="section-title" id="fees-title">头程、海外仓费用</h3>
<div class="switch-container">
<span class="switch-label">海外仓费用</span>
<label class="switch">
<input checked="" id="overseasToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="overseas-label">海外仓费用</label>
<input class="form-control output-value" id="overseasWarehouse" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">头程费用</span>
<label class="switch">
<input checked="" id="firstMileToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="firstmile-label">头程费用</label>
<input class="form-control output-value" id="firstMile" readonly="" type="text">
</input></div>
</div>
<div class="section">
<h3 class="section-title" id="platform-title">平台费用</h3>
<div class="output-group">
<label id="cashback-amount-label">下单返利</label>
<input class="form-control output-value" id="cashbackAmount" readonly="" type="text">
</input></div>
<div class="output-group">
<label id="kaspi-shipping-label">Kaspi 运费</label>
<input class="form-control output-value" id="kaspiShipping" readonly="" type="text">
</input></div>
<div class="output-group">
<label id="platform-fee-label">平台佣金</label>
<input class="form-control output-value" id="platformFee" readonly="" type="text"/>
</div>
<div class="output-group">
<label id="withdrawal-tax-label">提现税（4%）</label>
<input class="form-control output-value" id="withdrawalTax" readonly="" type="text"/>
</div>
</div>
</div>
<div class="results-section">
<h3 class="section-title" id="return-title">回款费用</h3>
<div class="switch-container">
<span class="switch-label">提现手续费</span>
<label class="switch">
<input checked="" id="withdrawalFeeToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="withdrawal-fee-label">提现手续费（1%）</label>
<input class="form-control output-value" id="withdrawalFee" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">汇损</span>
<label class="switch">
<input checked="" id="exchangeLossToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="exchange-loss-label">汇损（1.42%）</label>
<input class="form-control output-value" id="exchangeLoss" readonly="" type="text">
</input></div>
<div class="switch-container">
<span class="switch-label">汇款手续费</span>
<label class="switch">
<input checked="" id="remittanceFeeToggle" type="checkbox"/>
<span class="slider"></span>
</label>
</div>
<div class="output-group">
<label id="remittance-fee-label">汇款手续费</label>
<input class="form-control output-value" id="remittanceFee" readonly="" type="text">
</input></div>
<div class="results-grid">
<div class="result-item">
<div class="result-label" id="kaspi-pay-label">Kaspi pay提现到账金额</div>
<div class="result-value" id="kaspiPayAmount">0.00</div>
</div>
<div class="result-item">
<div class="result-label" id="return-amount-label">回款金额</div>
<div class="result-value" id="returnAmountDisplay">0.00</div>
</div>
<div class="result-item">
<div class="result-label" id="estimated-amount-label">预估到账金额</div>
<div class="result-value" id="estimatedAmount">0.00</div>
</div>
<div class="result-item final">
<div class="result-label" id="profit-label-final">利润</div>
<div class="result-value" id="profit">0.00</div>
</div>
</div>
<div class="currency-selector">
<div class="currency-option">
<input checked="" class="currency-radio" id="currency-cny" name="currency" type="radio" value="cny"/>
<label class="currency-label" for="currency-cny" id="cny-label">人民币 (CNY)</label>
</div>
<div class="currency-option">
<input class="currency-radio" id="currency-kzt" name="currency" type="radio" value="kzt"/>
<label class="currency-label" for="currency-kzt" id="kzt-label">哈萨克斯坦坚戈 (KZT)</label>
</div>
</div>
</div>
<div class="footer">
<p id="copyright">© 2023 新疆航贸通国际供应链有限公司 | Kaspi 电商利润计算器增强版</p>
</div>
</div>
<script>
        // 多语言支持
        const translations = {
            zh: {
                companyName: "新疆航贸通国际供应链有限公司",
                appTitle: "Kaspi 电商利润计算器增强版",
                exchangeLabel: "当前汇率：1元人民币兑换",
                currencyLabel: "哈萨克斯坦坚戈",
                productInfo: "产品信息",
                categoryLabel: "商品分类",
                purchaseLabel: "采购价 (¥)",
                shippingLabel: "运费 (¥)",
                profitLabel: "利润率（%）",
                cashbackLabel: "下单返利（%）",
                paymentLabel: "汇款方式",
                logisticsTitle: "物流信息",
                dimensionLabel: "尺寸（厘米）",
                volumeLabel: "体积（立方米）",
                weightLabel: "重量（千克）",
                kaspiPriceLabel: "Kaspi 售价",
                feesTitle: "头程、海外仓费用",
                overseasLabel: "海外仓费用",
                firstmileLabel: "头程费用",
                platformTitle: "平台费用",
                cashbackAmountLabel: "下单返利",
                kaspiShippingLabel: "Kaspi 运费",
                platformFeeLabel: "平台佣金",
                withdrawalTaxLabel: "提现税（4%）",
                returnTitle: "回款费用",
                withdrawalFeeLabel: "提现手续费（1%）",
                exchangeLossLabel: "汇损（1.42%）",
                remittanceFeeLabel: "汇款手续费",
                returnAmountLabel: "回款金额",
                kaspiPayLabel: "Kaspi pay提现到账金额",
                estimatedAmountLabel: "预估到账金额",
                profitLabelFinal: "利润",
                copyright: "© 2023 新疆航贸通国际供应链有限公司 | Kaspi 电商利润计算器增强版",
                calculateBtn: "计算利润",
                cnyLabel: "人民币 (CNY)",
                kztLabel: "哈萨克斯坦坚戈 (KZT)",
                commissionLabel: "当前佣金率：",
                purchasePlaceholder: "输入采购价",
                shippingPlaceholder: "阿拉木图运费",
                profitPlaceholder: "输入利润率",
                cashbackPlaceholder: "输入下单返利",
                weightPlaceholder: "输入重量",
                lengthPlaceholder: "长",
                widthPlaceholder: "宽",
                heightPlaceholder: "高",
                exchangePlaceholder: "输入汇率",
                categorySearchPlaceholder: "搜索分类...",
                overseasUnitLabel: "海外仓单价 (¥/m³)",
                firstmileUnitLabel: "头程单价 (¥/m³)"
            },
            ru: {
                companyName: "Синьцзянская Международная Логистическая Компания Хан Мао Тун",
                appTitle: "Улучшенный калькулятор прибыли Kaspi",
                exchangeLabel: "Текущий курс: 1 юань = ",
                currencyLabel: "казахстанских тенге",
                productInfo: "Информация о продукте",
                categoryLabel: "Категория товара",
                purchaseLabel: "Закупочная цена (₸)",
                shippingLabel: "Стоимость доставки (₸)",
                profitLabel: "Маржа прибыли (%)",
                cashbackLabel: "Кэшбэк за заказ (%)",
                paymentLabel: "Способ оплаты",
                logisticsTitle: "Логистическая информация",
                dimensionLabel: "Размеры (см)",
                volumeLabel: "Объем (м³)",
                weightLabel: "Вес (кг)",
                kaspiPriceLabel: "Цена на Kaspi",
                feesTitle: "Расходы на доставку и склад",
                overseasLabel: "Стоимость зарубежного склада (₸)",
                firstmileLabel: "Стоимость первой мили (₸)",
                platformTitle: "Платежи платформы",
                cashbackAmountLabel: "Сумма кэшбэка (₸)",
                kaspiShippingLabel: "Доставка Kaspi (₸)",
                platformFeeLabel: "Комиссия платформы (₸)",
                withdrawalTaxLabel: "Налог на вывод (4%) (₸)",
                returnTitle: "Расходы на возврат средств",
                withdrawalFeeLabel: "Комиссия за вывод (1%) (₸)",
                exchangeLossLabel: "Потери при обмене (1.42%) (₸)",
                remittanceFeeLabel: "Комиссия за перевод (₸)",
                returnAmountLabel: "Сумма возврата (₸)",
                kaspiPayLabel: "Сумма вывода Kaspi pay (₸)",
                estimatedAmountLabel: "Ожидаемая сумма к получению (₸)",
                profitLabelFinal: "Прибыль (₸)",
                copyright: "© 2023 Синьцзянская Международная Логистическая Компания Хан Мао Тун | Улучшенный калькулятор прибыли Kaspi",
                calculateBtn: "Рассчитать прибыль",
                cnyLabel: "Юань (CNY)",
                kztLabel: "Тенге (KZT)",
                commissionLabel: "Текущая комиссия: ",
                purchasePlaceholder: "Введите закупочную цену",
                shippingPlaceholder: "Стоимость доставки в Алматы",
                profitPlaceholder: "Введите маржу прибыли",
                cashbackPlaceholder: "Введите кэшбэк за заказ",
                weightPlaceholder: "Введите вес",
                lengthPlaceholder: "Длина",
                widthPlaceholder: "Ширина",
                heightPlaceholder: "Высота",
                exchangePlaceholder: "Введите курс обмена",
                categorySearchPlaceholder: "Поиск категории...",
                overseasUnitLabel: "Цена зарубежного склада (₸/м³)",
                firstmileUnitLabel: "Цена первой мили (₸/м³)"
            }
        };

        // 商品分类数据
        const categories = [
            { id: "auto-cards", name: { zh: "汽车名片", ru: "Автомобильные визитки" }, commission: 0.12 },
            { id: "watch-straps", name: { zh: "手表带", ru: "Ювелирные ремешки и браслеты для часов" }, commission: 0.15 },
            { id: "electronics", name: { zh: "电子产品", ru: "Электроника" }, commission: 0.10 },
            { id: "home-appliances", name: { zh: "家用电器", ru: "Бытовая техника" }, commission: 0.08 },
            { id: "clothing", name: { zh: "服装", ru: "Одежда" }, commission: 0.18 }
        ];

        // 扁平化分类数据用于搜索
        let flatCategories = [];

        function flattenCategories(categories, level = 1, parentPath = "") {
            categories.forEach(cat => {
                const path = parentPath ? `${parentPath} > ${cat.name.zh}` : cat.name.zh;
                flatCategories.push({
                    id: cat.id,
                    name: cat.name,
                    commission: cat.commission,
                    level: level,
                    path: path
                });
            });
        }

        flattenCategories(categories);

        document.addEventListener('DOMContentLoaded', function () {
            // 初始化变量
            let currentLanguage = 'zh';
            let currentCurrency = 'cny';
            let currentCommission = 0.12; // 默认佣金率

            // 获取DOM元素
            const exchangeRate = document.getElementById('exchangeRate');
            const purchasePrice = document.getElementById('purchasePrice');
            const shippingCost = document.getElementById('shippingCost');
            const profitMargin = document.getElementById('profitMargin');
            const cashback = document.getElementById('cashback');
            const paymentMethod = document.getElementById('paymentMethod');
            const length = document.getElementById('length');
            const width = document.getElementById('width');
            const height = document.getElementById('height');
            const volume = document.getElementById('volume');
            const weight = document.getElementById('weight');
            const kaspiPriceCny = document.getElementById('kaspiPriceCny');
            const kaspiPriceKzt = document.getElementById('kaspiPriceKzt');
            const overseasWarehouse = document.getElementById('overseasWarehouse');
            const firstMile = document.getElementById('firstMile');
            const cashbackAmount = document.getElementById('cashbackAmount');
            const kaspiShipping = document.getElementById('kaspiShipping');
            const platformFee = document.getElementById('platformFee');
            const withdrawalTax = document.getElementById('withdrawalTax');
            const withdrawalFee = document.getElementById('withdrawalFee');
            const exchangeLoss = document.getElementById('exchangeLoss');
            const remittanceFee = document.getElementById('remittanceFee');
            const kaspiPayAmount = document.getElementById('kaspiPayAmount');
            const returnAmountDisplay = document.getElementById('returnAmountDisplay');
            const estimatedAmount = document.getElementById('estimatedAmount');
            const profit = document.getElementById('profit');
            const calculateBtn = document.getElementById('calculateBtn');
            const commissionDisplay = document.getElementById('commission-display');
            const container = document.querySelector('.container');
            
            // 新增元素
            const overseasUnitPrice = document.getElementById('overseasUnitPrice');
            const firstMileUnitPrice = document.getElementById('firstMileUnitPrice');
            const overseasToggle = document.getElementById('overseasToggle');
            const firstMileToggle = document.getElementById('firstMileToggle');
            const withdrawalFeeToggle = document.getElementById('withdrawalFeeToggle');
            const exchangeLossToggle = document.getElementById('exchangeLossToggle');
            const remittanceFeeToggle = document.getElementById('remittanceFeeToggle');

            // 错误消息元素
            const exchangeError = document.getElementById('exchange-error');
            const purchaseError = document.getElementById('purchase-error');
            const shippingError = document.getElementById('shipping-error');
            const profitError = document.getElementById('profit-error');
            const weightError = document.getElementById('weight-error');

            // 分类选择器
            const categorySelect = document.getElementById('category-select');
            const categorySearch = document.getElementById('category-search');
            const searchResults = document.getElementById('search-results');

            // 货币选择器
            const currencyCny = document.getElementById('currency-cny');
            const currencyKzt = document.getElementById('currency-kzt');

            // 初始化分类选择器
            function populateCategorySelect(selectElement, categories, placeholder) {
                // 保存当前选中的值
                const selectedValue = selectElement.value;
                
                selectElement.innerHTML = '';
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = placeholder;
                defaultOption.dataset.commission = '';
                selectElement.appendChild(defaultOption);

                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name[currentLanguage];
                    option.dataset.commission = cat.commission;
                    selectElement.appendChild(option);
                });
                
                // 恢复选中的值
                if (selectedValue) {
                    selectElement.value = selectedValue;
                }
            }

            // 填充商品分类
            populateCategorySelect(categorySelect, categories, currentLanguage === 'zh' ? '-- 请选择商品分类 --' : '-- Выберите категорию товара --');

            // 分类选择变化事件
            categorySelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                currentCommission = parseFloat(selectedOption.dataset.commission) || 0.12;
                
                // 更新佣金显示
                const trans = translations[currentLanguage];
                commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
                
                // 重新计算
                calculateAll();
            });

            // 分类搜索功能
            categorySearch.addEventListener('input', function () {
                const searchTerm = this.value.toLowerCase();
                if (!searchTerm) {
                    searchResults.style.display = 'none';
                    return;
                }

                const results = flatCategories.filter(cat =>
                    cat.name.zh.toLowerCase().includes(searchTerm) ||
                    cat.name.ru.toLowerCase().includes(searchTerm)
                );

                if (results.length === 0) {
                    searchResults.style.display = 'none';
                    return;
                }

                searchResults.innerHTML = '';
                results.forEach(cat => {
                    const div = document.createElement('div');
                    div.className = 'search-result-item';
                    div.textContent = currentLanguage === 'zh' ? cat.path : cat.name.ru;
                    div.dataset.id = cat.id;
                    div.dataset.commission = cat.commission;
                    div.dataset.level = cat.level;
                    searchResults.appendChild(div);
                });

                searchResults.style.display = 'block';
            });

            // 处理搜索结果选择
            searchResults.addEventListener('click', function (e) {
                if (e.target.classList.contains('search-result-item')) {
                    const catId = e.target.dataset.id;
                    const commission = e.target.dataset.commission;
                    
                    // 设置佣金率
                    currentCommission = parseFloat(commission) || 0.12;
                    
                    // 更新佣金显示
                    const trans = translations[currentLanguage];
                    commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
                    
                    // 查找并设置分类
                    const foundCategory = flatCategories.find(cat => cat.id === catId);
                    if (foundCategory) {
                        categorySelect.value = catId;
                    }

                    categorySearch.value = '';
                    searchResults.style.display = 'none';
                    
                    // 重新计算
                    calculateAll();
                }
            });

            // 点击搜索图标聚焦搜索框
            document.querySelector('.search-icon').addEventListener('click', function () {
                categorySearch.focus();
            });

            // 语言切换功能
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const oldLanguage = currentLanguage;
                    currentLanguage = this.dataset.lang;
                    
                    // 更新按钮状态
                    document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 更新body类名
                    document.body.className = '';
                    document.body.classList.add(`lang-${currentLanguage}`);

                    // 更新页面文本
                    updateLanguage();
                    
                    // 转换货币值
                    const rate = parseFloat(exchangeRate.value) || 70;
                    
                    // 需要转换的字段
                    const fieldsToConvert = [
                        purchasePrice, 
                        shippingCost,
                        overseasUnitPrice,
                        firstMileUnitPrice
                    ];
                    
                    fieldsToConvert.forEach(field => {
                        const value = parseFloat(field.value);
                        if (!isNaN(value)) {
                            if (oldLanguage === 'zh' && currentLanguage === 'ru') {
                                // 人民币 → 坚戈
                                field.value = (value * rate).toFixed(2);
                            } else if (oldLanguage === 'ru' && currentLanguage === 'zh') {
                                // 坚戈 → 人民币
                                field.value = (value / rate).toFixed(2);
                            }
                        }
                    });
                    
                    // 初始化新语言的默认单价
                    initializeDefaultPrices();
                    
                    // 更新支付方式选项
                    if (currentLanguage === 'ru') {
                        paymentMethod.innerHTML = '<option value="kaspi">Kaspi.kz</option>';
                        currencyKzt.checked = true;
                        currentCurrency = 'kzt';
                    } else {
                        // 恢复中文支付方式选项
                        paymentMethod.innerHTML = `
                            <option value="publicToPublic">银行公对公</option>
                            <option value="publicToPrivate">银行公对私</option>
                            <option value="privateToPrivate">银行私对私</option>
                            <option value="wechat">微信</option>
                            <option value="alipay">支付宝</option>
                            <option value="kaspi">Kaspi.kz</option>
                        `;
                        currencyCny.checked = true;
                        currentCurrency = 'cny';
                    }
                    
                    // 重新计算
                    calculateAll();
                });
            });

            // 货币切换功能
            document.querySelectorAll('.currency-radio').forEach(radio => {
                radio.addEventListener('change', function () {
                    currentCurrency = this.value;
                    calculateAll(); // 重新计算并显示结果
                });
            });

            // 更新页面语言
            function updateLanguage() {
                const trans = translations[currentLanguage];

                // 更新文本内容
                document.getElementById('company-name').textContent = trans.companyName;
                document.getElementById('app-title').textContent = trans.appTitle;
                document.getElementById('exchange-label').textContent = trans.exchangeLabel;
                document.getElementById('currency-label').textContent = trans.currencyLabel;
                document.getElementById('product-info-title').textContent = trans.productInfo;
                document.getElementById('category-label').textContent = trans.categoryLabel;
                document.getElementById('purchase-label').textContent = trans.purchaseLabel;
                document.getElementById('shipping-label').textContent = trans.shippingLabel;
                document.getElementById('profit-label').textContent = trans.profitLabel;
                document.getElementById('cashback-label').textContent = trans.cashbackLabel;
                document.getElementById('payment-label').textContent = trans.paymentLabel;
                document.getElementById('logistics-title').textContent = trans.logisticsTitle;
                document.getElementById('dimension-label').textContent = trans.dimensionLabel;
                document.getElementById('volume-label').textContent = trans.volumeLabel;
                document.getElementById('weight-label').textContent = trans.weightLabel;
                document.getElementById('kaspi-price-label').textContent = trans.kaspiPriceLabel;
                document.getElementById('fees-title').textContent = trans.feesTitle;
                document.getElementById('overseas-label').textContent = trans.overseasLabel;
                document.getElementById('firstmile-label').textContent = trans.firstmileLabel;
                document.getElementById('platform-title').textContent = trans.platformTitle;
                document.getElementById('cashback-amount-label').textContent = trans.cashbackAmountLabel;
                document.getElementById('kaspi-shipping-label').textContent = trans.kaspiShippingLabel;
                document.getElementById('platform-fee-label').textContent = trans.platformFeeLabel;
                document.getElementById('withdrawal-tax-label').textContent = trans.withdrawalTaxLabel;
                document.getElementById('return-title').textContent = trans.returnTitle;
                document.getElementById('withdrawal-fee-label').textContent = trans.withdrawalFeeLabel;
                document.getElementById('exchange-loss-label').textContent = trans.exchangeLossLabel;
                document.getElementById('remittance-fee-label').textContent = trans.remittanceFeeLabel;
                document.getElementById('return-amount-label').textContent = trans.returnAmountLabel;
                document.getElementById('kaspi-pay-label').textContent = trans.kaspiPayLabel;
                document.getElementById('estimated-amount-label').textContent = trans.estimatedAmountLabel;
                document.getElementById('profit-label-final').textContent = trans.profitLabelFinal;
                document.getElementById('copyright').textContent = trans.copyright;
                document.getElementById('cny-label').textContent = trans.cnyLabel;
                document.getElementById('kzt-label').textContent = trans.kztLabel;
                
                document.getElementById('kaspi-price-cny-label').textContent = trans.kaspiPriceCnyLabel;
                document.getElementById('kaspi-price-kzt-label').textContent = trans.kaspiPriceKztLabel;
    document.getElementById('overseas-unit-label').textContent = trans.overseasUnitLabel;
                document.getElementById('firstmile-unit-label').textContent = trans.firstmileUnitLabel;

                // 更新按钮文本
                calculateBtn.textContent = trans.calculateBtn;

                // 更新占位符文本
                categorySearch.placeholder = trans.categorySearchPlaceholder;
                purchasePrice.placeholder = trans.purchasePlaceholder;
                shippingCost.placeholder = trans.shippingPlaceholder;
                profitMargin.placeholder = trans.profitPlaceholder;
                cashback.placeholder = trans.cashbackPlaceholder;
                weight.placeholder = trans.weightPlaceholder;
                length.placeholder = trans.lengthPlaceholder;
                width.placeholder = trans.widthPlaceholder;
                height.placeholder = trans.heightPlaceholder;
                exchangeRate.placeholder = trans.exchangePlaceholder;
                
                // 更新分类选择框
                populateCategorySelect(categorySelect, categories, currentLanguage === 'zh' ? '-- 请选择商品分类 --' : '-- Выберите категорию товара --');
                
                // 更新佣金显示
                commissionDisplay.textContent = trans.commissionLabel + (currentCommission * 100).toFixed(0) + '%';
            }

            // 验证输入
            function validateInputs() {
                let isValid = true;
                
                // 隐藏所有错误消息
                exchangeError.style.display = 'none';
                purchaseError.style.display = 'none';
                shippingError.style.display = 'none';
                profitError.style.display = 'none';
                weightError.style.display = 'none';
                
                // 验证汇率
                const rate = parseFloat(exchangeRate.value);
                if (isNaN(rate)) { 
                    exchangeError.textContent = currentLanguage === 'zh' ? '请输入汇率' : 'Введите курс обмена';
                    exchangeError.style.display = 'block';
                    isValid = false;
                } else if (rate <= 0) {
                    exchangeError.textContent = currentLanguage === 'zh' ? '汇率必须大于0' : 'Курс должен быть больше 0';
                    exchangeError.style.display = 'block';
                    isValid = false;
                }
                
                // 验证采购价
                const purchase = parseFloat(purchasePrice.value);
                if (isNaN(purchase) || purchase < 0) { 
                    purchaseError.textContent = currentLanguage === 'zh' ? '请输入有效的采购价' : 'Введите действительную закупочную цену';
                    purchaseError.style.display = 'block';
                    isValid = false;
                }
                
                // 验证运费
                const shipping = parseFloat(shippingCost.value);
                if (isNaN(shipping) || shipping < 0) { 
                    shippingError.textContent = currentLanguage === 'zh' ? '请输入有效的运费' : 'Введите действительную стоимость доставки';
                    shippingError.style.display = 'block';
                    isValid = false;
                }
                
                // 验证利润率
                const margin = parseFloat(profitMargin.value);
                if (isNaN(margin) || margin < 0) { 
                    profitError.textContent = currentLanguage === 'zh' ? '请输入有效的利润率' : 'Введите действительную маржу прибыли';
                    profitError.style.display = 'block';
                    isValid = false;
                }
                
                // 验证重量
                const w = parseFloat(weight.value);
                if (isNaN(w) || w <= 0) { 
                    weightError.textContent = currentLanguage === 'zh' ? '请输入有效的重量' : 'Введите действительный вес';
                    weightError.style.display = 'block';
                    isValid = false;
                }
                
                return isValid;
            }

            // 计算体积
            function calculateVolume() {
                const l = parseFloat(length.value) || 0;
                const w = parseFloat(width.value) || 0;
                const h = parseFloat(height.value) || 0;

                if (l > 0 && w > 0 && h > 0) {
                    const vol = (l / 100) * (w / 100) * (h / 100);
                    volume.value = vol.toFixed(4) + ' m³';
                    return vol;
                }

                volume.value = '';
                return 0;
            }

            // 计算所有费用并显示结果
            function calculateAll() {
                // 验证输入
                if (!validateInputs()) {
                    return;
                }
                
                // 获取输入值
                const rate = parseFloat(exchangeRate.value);
                const purchase = parseFloat(purchasePrice.value) || 0;
                const shipping = parseFloat(shippingCost.value) || 0;
                const margin = parseFloat(profitMargin.value) || 0;
                const cb = parseFloat(cashback.value) || 0;
                const w = parseFloat(weight.value) || 0;
                const vol = calculateVolume();
                const cat = currentCommission;
                
                // 获取费用单价
                const overseasUnit = parseFloat(overseasUnitPrice.value) || 1000;
                const firstMileUnit = parseFloat(firstMileUnitPrice.value) || 100;

                // 计算Kaspi售价（人民币）
                let kaspiPriceCnyValue;
                if (currentLanguage === 'ru') {
                    // 俄语界面：采购价和运费是坚戈，需要转换为人民币
                    kaspiPriceCnyValue = (purchase + shipping) * (1 + margin / 100) / rate;
                } else {
                    // 中文界面：采购价和运费是人民币
                    kaspiPriceCnyValue = (purchase + shipping) * (1 + margin / 100);
                }

                // 计算Kaspi售价（坚戈）
                const kaspiPriceKztValue = kaspiPriceCnyValue * rate;

                // 更新双列Kaspi售价显示
                kaspiPriceCny.value = kaspiPriceCnyValue.toFixed(2) + '¥';
                kaspiPriceKzt.value = kaspiPriceKztValue.toFixed(2) + '₸';

                // === 修改点2：海外仓费用计算（中文界面不除汇率）===
                let overseasValue = 0;
                if (overseasToggle.checked && vol > 0) {
                    if (vol <= 1) {
                        if (currentLanguage === 'zh') {
                            // 中文界面：直接使用人民币计算
                            overseasValue = overseasUnit;
                        } else {
                            // 俄语界面：坚戈转人民币
                            overseasValue = overseasUnit / rate;
                        }
                    } else {
                        if (currentLanguage === 'zh') {
                            // 中文界面：直接使用人民币计算
                            overseasValue = Math.ceil(vol) * overseasUnit;
                        } else {
                            // 俄语界面：坚戈转人民币
                            overseasValue = (Math.ceil(vol) * overseasUnit) / rate;
                        }
                    }
                }

                // === 修改点3：头程费用计算（中文界面不除汇率）===
                let firstMileValue = 0;
                if (firstMileToggle.checked && vol > 0) {
                    if (vol <= 0.01) {
                        if (currentLanguage === 'zh') {
                            // 中文界面：直接使用人民币计算
                            firstMileValue = firstMileUnit;
                        } else {
                            // 俄语界面：坚戈转人民币
                            firstMileValue = firstMileUnit / rate;
                        }
                    } else {
                        if (currentLanguage === 'zh') {
                            // 中文界面：直接使用人民币计算
                            firstMileValue = vol * firstMileUnit;
                        } else {
                            // 俄语界面：坚戈转人民币
                            firstMileValue = (vol * firstMileUnit) / rate;
                        }
                    }
                }

                // 4. 计算下单返利（人民币）
                const cashbackValue = (cb / 100 * kaspiPriceKztValue) / rate;

                // 5. 计算Kaspi运费（人民币）
                let kaspiShippingValue = 0;
                if (kaspiPriceKztValue > 0) {
                    if (kaspiPriceKztValue < 5000) {
                        kaspiShippingValue = 0;
                    } else if (kaspiPriceKztValue <= 15000) {
                        kaspiShippingValue = 799 / rate;
                    } else {
                        if (w < 5) {
                            kaspiShippingValue = 1299 / rate;
                        } else if (w <= 15) {
                            kaspiShippingValue = 1699 / rate;
                        } else if (w <= 50) {
                            kaspiShippingValue = 3599 / rate;
                        } else {
                            kaspiShippingValue = 6499 / rate;
                        }
                    }
                }

                // 6. 计算平台佣金（人民币）
                const platformFeeValue = (kaspiPriceKztValue * cat) / rate;

                // 7. 计算提现税（4%）（人民币）
                const baseAmount = kaspiPriceKztValue / rate;
                const withdrawalTaxValue = (baseAmount - cashbackValue - kaspiShippingValue - platformFeeValue) * 0.04;

                // 8. 计算Kaspi pay提现到账金额（人民币）
                const kaspiPayAmountValue = baseAmount - cashbackValue - kaspiShippingValue - platformFeeValue - withdrawalTaxValue;

                // 9. 计算提现手续费（1%）（人民币） - 考虑开关状态
                let withdrawalFeeValue = 0;
                if (withdrawalFeeToggle.checked) {
                    withdrawalFeeValue = kaspiPayAmountValue * 0.01;
                }

                // 10. 计算回款金额（人民币）
                const returnAmountValue = kaspiPayAmountValue - withdrawalFeeValue - overseasValue - firstMileValue;

                // 11. 计算汇损（1.42%）（人民币） - 考虑开关状态
                let exchangeLossValue = 0;
                if (exchangeLossToggle.checked) {
                    exchangeLossValue = returnAmountValue * 0.0142;
                }

                // 12. 计算汇款手续费（人民币） - 考虑开关状态
                let remittanceFeeValue = 0;
                if (remittanceFeeToggle.checked && returnAmountValue > 0) {
                    const method = paymentMethod.value;
                    switch (method) {
                        case 'publicToPublic':
                            if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 100000) {
                                remittanceFeeValue = 10;
                            } else if (returnAmountValue <= 500000) {
                                remittanceFeeValue = 15;
                            } else if (returnAmountValue <= 1000000) {
                                remittanceFeeValue = 20;
                            } else {
                                remittanceFeeValue = Math.min(200, Math.ceil(returnAmountValue * 0.00002 * 100) / 100);
                            }
                            break;
                        case 'publicToPrivate':
                            if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 100000) {
                                remittanceFeeValue = 10;
                            } else if (returnAmountValue <= 500000) {
                                remittanceFeeValue = 15;
                            } else if (returnAmountValue <= 1000000) {
                                remittanceFeeValue = 20;
                            } else {
                                remittanceFeeValue = Math.min(200, Math.ceil(returnAmountValue * 0.00002 * 100) / 100);
                            }
                            break;
                        case 'privateToPrivate':
                            if (returnAmountValue <= 5000) {
                                remittanceFeeValue = 0;
                            } else if (returnAmountValue <= 10000) {
                                remittanceFeeValue = 5;
                            } else if (returnAmountValue <= 50000) {
                                remittanceFeeValue = 7.5;
                            } else {
                                remittanceFeeValue = Math.min(25, Math.ceil(returnAmountValue * 0.00015 * 100) / 100);
                            }
                            break;
                        case 'wechat':
                            remittanceFeeValue = Math.max(0.1, Math.ceil(returnAmountValue * 0.001 * 100) / 100);
                            break;
                        case 'alipay':
                            remittanceFeeValue = Math.max(0.1, Math.ceil(returnAmountValue * 0.001 * 100) / 100);
                            break;
                        case 'kaspi':
                            remittanceFeeValue = 0;
                            break;
                        default:
                            remittanceFeeValue = 0;
                    }
                }

                // 13. 计算预估到账金额（人民币）
                const estimatedAmountValue = returnAmountValue - exchangeLossValue - remittanceFeeValue;

                // 14. 计算利润
                let profitValue;
                if (currentLanguage === 'ru') {
                    // 俄语界面:输入值是坚戈,需要转换为人民币
                    const purchaseInCNY = purchase / rate;
                    const shippingInCNY = shipping / rate;
                    profitValue = estimatedAmountValue - purchaseInCNY - shippingInCNY;
                } else {
                    // 中文界面:输入值已经是人民币
                    profitValue = estimatedAmountValue - purchase - shipping;
                }

                // 显示结果时的货币转换
                const currencyRate = currentCurrency === 'kzt' ? rate : 1;
                const currencySymbol = currentCurrency === 'kzt' ? '₸' : '¥';

                // 更新显示结果
                overseasWarehouse.value = (overseasValue * currencyRate).toFixed(2) + currencySymbol;
                firstMile.value = (firstMileValue * currencyRate).toFixed(2) + currencySymbol;
                cashbackAmount.value = (cashbackValue * currencyRate).toFixed(2) + currencySymbol;
                kaspiShipping.value = (kaspiShippingValue * currencyRate).toFixed(2) + currencySymbol;
                platformFee.value = (platformFeeValue * currencyRate).toFixed(2) + currencySymbol;
                withdrawalTax.value = (withdrawalTaxValue * currencyRate).toFixed(2) + currencySymbol;
                withdrawalFee.value = (withdrawalFeeValue * currencyRate).toFixed(2) + currencySymbol;
                exchangeLoss.value = (exchangeLossValue * currencyRate).toFixed(2) + currencySymbol;
                remittanceFee.value = (remittanceFeeValue * currencyRate).toFixed(2) + currencySymbol;
                kaspiPayAmount.textContent = (kaspiPayAmountValue * currencyRate).toFixed(2) + currencySymbol;
                returnAmountDisplay.textContent = (returnAmountValue * currencyRate).toFixed(2) + currencySymbol;
                estimatedAmount.textContent = (estimatedAmountValue * currencyRate).toFixed(2) + currencySymbol;
                profit.textContent = (profitValue * currencyRate).toFixed(2) + currencySymbol;

                // 根据利润值设置颜色
                if (profitValue > 0) {
                    profit.style.color = '#27ae60';
                } else if (profitValue < 0) {
                    profit.style.color = '#c0392b';
                } else {
                    profit.style.color = '#e65100';
                }
                
                // 更新开关标签状态
                updateToggleLabels();
            }
            
            // 更新开关标签状态
            function updateToggleLabels() {
                const toggles = [
                    { toggle: overseasToggle, label: document.querySelector('#overseas-label') },
                    { toggle: firstMileToggle, label: document.querySelector('#firstmile-label') },
                    { toggle: withdrawalFeeToggle, label: document.querySelector('#withdrawal-fee-label') },
                    { toggle: exchangeLossToggle, label: document.querySelector('#exchange-loss-label') },
                    { toggle: remittanceFeeToggle, label: document.querySelector('#remittance-fee-label') }
                ];
                
                toggles.forEach(item => {
                    if (item.toggle.checked) {
                        item.label.classList.remove('toggle-off');
                    } else {
                        item.label.classList.add('toggle-off');
                    }
                });
            }

            // 添加事件监听器
            calculateBtn.addEventListener('click', calculateAll);
            
            // 开关变化时重新计算
            overseasToggle.addEventListener('change', calculateAll);
            firstMileToggle.addEventListener('change', calculateAll);
            withdrawalFeeToggle.addEventListener('change', calculateAll);
            exchangeLossToggle.addEventListener('change', calculateAll);
            remittanceFeeToggle.addEventListener('change', calculateAll);
            
            // 费用单价变化时重新计算
            overseasUnitPrice.addEventListener('input', calculateAll);
            firstMileUnitPrice.addEventListener('input', calculateAll);

            // 尺寸变化时自动计算体积
            length.addEventListener('input', calculateVolume);
            width.addEventListener('input', calculateVolume);
            height.addEventListener('input', calculateVolume);
            
            // 输入变化时隐藏错误消息
            exchangeRate.addEventListener('input', () => exchangeError.style.display = 'none');
            purchasePrice.addEventListener('input', () => purchaseError.style.display = 'none');
            shippingCost.addEventListener('input', () => shippingError.style.display = 'none');
            profitMargin.addEventListener('input', () => profitError.style.display = 'none');
            weight.addEventListener('input', () => weightError.style.display = 'none');

            // 初始化默认单价（基于当前语言）
            function initializeDefaultPrices() {
                const rate = parseFloat(exchangeRate.value) || 70;
                
                if (currentLanguage === 'zh') {
                    // 中文：设置人民币默认值
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = (1000 / rate).toFixed(2);
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = (100 / rate).toFixed(2);
                    }
                } else {
                    // 俄语：设置坚戈默认值
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = '1000';
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = '100';
                    }
                }
            }

            // 当汇率变化时更新中文界面的默认单价
            exchangeRate.addEventListener('input', function() {
                if (currentLanguage === 'zh') {
                    const rate = parseFloat(this.value) || 70;
                    
                    // 只更新未修改过的默认值
                    if (!overseasUnitPrice.dataset.userSet) {
                        overseasUnitPrice.value = (1000 / rate).toFixed(2);
                    }
                    if (!firstMileUnitPrice.dataset.userSet) {
                        firstMileUnitPrice.value = (100 / rate).toFixed(2);
                    }
                    
                    calculateAll();
                }
            });

            // 标记用户是否修改过单价
            overseasUnitPrice.addEventListener('input', function() {
                this.dataset.userSet = 'true';
            });

            firstMileUnitPrice.addEventListener('input', function() {
                this.dataset.userSet = 'true';
            });

            // 初始化页面
            function initializePage() {
                updateLanguage();
                initializeDefaultPrices();
                calculateVolume();
                calculateAll();
            }

            // 在DOMContentLoaded事件的最后调用初始化函数
            initializePage();
        });
    </script>
</body>
</html>